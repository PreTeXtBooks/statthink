<?xml version="1.0" encoding="UTF-8" ?>

<chapter xml:id="ch-linear-regression" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Linear Regression</title>

  <section xml:id="sec-student-learning-objectives-14">
    <title>Student Learning Objectives</title>
    <p>
      In the previous chapter we examined the situation where the response is numeric and the explanatory variable is a factor with two levels. This chapter deals with the case where both the response and the explanatory variables are numeric. The method that is used in order to describe the relations between the two variables is <em>regression</em>. Here we apply <em>linear regression</em> to deal with a linear relation between two numeric variables. This type of regression fits a line to the data. The line summarizes the effect of the explanatory variable on the distribution of the response.
    </p>
    <p>
      Statistical inference can be conducted in the context of regression. Specifically, one may fit the regression model to the data. This corresponds to the point estimation of the parameters of the model. Also, one may produce confidence intervals for the parameters and carry out hypotheses testing. Another issue that is considered is the assessment of the percentage of variability of the response that is explained by the regression model.
    </p>
    <p>
      By the end of this chapter, the student should be able to:
    </p>
    <ul>
      <li><p>Produce scatter plots of the response and the explanatory variable.</p></li>
      <li><p>Explain the relation between a line and the parameters of a linear equation. Add lines to a scatter plot.</p></li>
      <li><p>Fit the linear regression to data using the function <q><c>lm</c></q> and conduct statistical inference on the fitted model.</p></li>
      <li><p>Explain the relations among <m>R^2</m>, the percentage of response variability explained by the regression model, the variability of the regression residuals, and the variance of the response.</p></li>
    </ul>
  </section>

  <section xml:id="sec-simple-linear-regression">
    <title>Points and Lines</title>
    <p>
      In this section we consider the graphical representation of the response and the explanatory variables on the same plot. The data associated with both variables is plotted as points in a two-dimensional plane. Linear equations can be represented as lines on the same two-dimensional plane. This section prepares the background for the discussion of the linear regression model. The actual model of linear regression is introduced in the next section.
    </p>

    <subsection xml:id="subsec-scatter-plot">
      <title>The Scatter Plot</title>
      <p>
        Consider two numeric variables. A scatter plot can be used in order to display the data in these two variables. The scatter plot is a graph in which each observation is represented as a point. Examination of the scatter plot may reveal relations between the two variables.
      </p>
      <p>
        Consider an example. A marine biologist measured the length (in millimeters) and the weight (in grams) of 10 fish that were collected in one of her expeditions. The results are summarized in a data frame that is presented in <xref ref="table-regression-1" />. Notice that the data frame contains 10 observations. The variable <m>x</m> corresponds to the length of the fish and the variable <m>y</m> corresponds to the weight.
      </p>

      <table xml:id="table-regression-1">
        <title>Data</title>
        <tabular>
          <row header="yes">
            <cell>Observation</cell>
            <cell><m>x</m></cell>
            <cell><m>y</m></cell>
          </row>
          <row>
            <cell>1</cell>
            <cell>4.5</cell>
            <cell>9.5</cell>
          </row>
          <row>
            <cell>2</cell>
            <cell>3.7</cell>
            <cell>8.2</cell>
          </row>
          <row>
            <cell>3</cell>
            <cell>1.8</cell>
            <cell>4.9</cell>
          </row>
          <row>
            <cell>4</cell>
            <cell>1.3</cell>
            <cell>6.7</cell>
          </row>
          <row>
            <cell>5</cell>
            <cell>3.2</cell>
            <cell>12.9</cell>
          </row>
          <row>
            <cell>6</cell>
            <cell>3.8</cell>
            <cell>14.1</cell>
          </row>
          <row>
            <cell>7</cell>
            <cell>2.5</cell>
            <cell>5.6</cell>
          </row>
          <row>
            <cell>8</cell>
            <cell>4.5</cell>
            <cell>8.0</cell>
          </row>
          <row>
            <cell>9</cell>
            <cell>4.1</cell>
            <cell>12.6</cell>
          </row>
          <row>
            <cell>10</cell>
            <cell>1.1</cell>
            <cell>7.2</cell>
          </row>
        </tabular>
      </table>

      <p>
        Let us display this data in a scatter plot. Towards that end, let us read the length data into an object by the name <q><c>x</c></q> and the weight data into an object by the name <q><c>y</c></q>. Finally, let us apply the function <q><c>plot</c></q> to the formula that relates the response <q><c>y</c></q> to the explanatory variable <q><c>x</c></q>:
      </p>

      <program language="r">
        <input>
x &lt;- c(4.5,3.7,1.8,1.3,3.2,3.8,2.5,4.5,4.1,1.1)
y &lt;- c(9.5,8.2,4.9,6.7,12.9,14.1,5.6,8.0,12.6,7.2)
plot(y~x)
        </input>
      </program>

      <p>
        The scatter plot that is produced by the last expression is presented in <xref ref="fig-regression1" />.
      </p>

      <figure xml:id="fig-regression1">
        <caption>A Scatter Plot</caption>
        <image source="_figures/Regression1.png" width="60%">
          <description>Scatter plot showing relationship between fish length (x-axis) and weight (y-axis)</description>
        </image>
      </figure>

      <p>
        A scatter plot is a graph that displays jointly the data of two numerical variables. The variables (<q><c>x</c></q> and <q><c>y</c></q> in this case) are represented by the <m>x</m>-axis and the <m>y</m>-axis, respectively. The <m>x</m>-axis is associated with the explanatory variable and the <m>y</m>-axis is associated with the response.
      </p>
      <p>
        Each observation is represented by a point. The <m>x</m>-value of the point corresponds to the value of the explanatory variable for the observation and the <m>y</m>-value corresponds to the value of the response. For example, the first observation is represented by the point <m>(x=4.5,y=9.5)</m>. The two rightmost points have an <m>x</m> value of 4.5. The higher of the two has a <m>y</m> value of 9.5 and is therefore point associated with the first observation. The lower of the two has a <m>y</m> value of 8.0, and is thus associated with the 8th observation. Altogether there are 10 points in the plot, corresponding to the 10 observations in the data frame.
      </p>
      <p>
        Let us consider another example of a scatter plot. The file <q><c>cars.csv</c></q> contains data regarding characteristics of cars. Among the variables in this data frame are the variables <q><c>horsepower</c></q> and the variable <q><c>engine.size</c></q>. Both variables are numeric.
      </p>
      <p>
        The variable <q><c>engine.size</c></q> describes the volume, in cubic inches, that is swept by all the pistons inside the cylinders. The variable <q><c>horsepower</c></q> measures the power of the engine in units of horsepower. Let us examine the relation between these two variables with a scatter plot:
      </p>

      <program language="r">
        <input>
cars &lt;- read.csv("_data/cars.csv")
plot(horsepower ~ engine.size, data=cars)
        </input>
      </program>

      <p>
        In the first line of code we read the data from the file into an <c>R</c> data frame that is given the name <q><c>cars</c></q>. In the second line we produce the scatter plot with <q><c>horsepower</c></q> as the response and <q><c>engine.size</c></q> as the explanatory variable. Both variables are taken from the data frame <q><c>cars</c></q>. The plot that is produced by the last expression is presented in <xref ref="fig-regression2" />.
      </p>

      <figure xml:id="fig-regression2">
        <caption>The Scatter Plot of Power versus Engine Size</caption>
        <image source="_figures/Regression2.png" width="60%">
          <description>Scatter plot showing relationship between engine size (x-axis) and horsepower (y-axis)</description>
        </image>
      </figure>

      <p>
        Consider the expression <c>plot(horsepower~engine.size, data=cars)</c>. Both the response variable and the explanatory variables that are given in this expression do not exist in the computer's memory as independent objects, but only as variables within the object <q><c>cars</c></q>. In some cases, however, one may refer to these variables directly within the function, provided that the argument <c>data=<em>data.frame.name</em></c> is added to the function. This argument informs the function in which data frame the variables can be found, where <em>data.frame.name</em> is the name of the data frame. In the current example, the variables are located in the data frame <q><c>cars</c></q>.
      </p>
      <p>
        Examine the scatter plot in <xref ref="fig-regression2" />. One may see that the values of the response (<c>horsepower</c>) tend to increase with the increase in the values of the explanatory variable (<c>engine.size</c>). Overall, the increase tends to follow a linear trend, a straight line, although the data points are not located exactly on a single line. The role of linear regression, which will be discussed in the subsequent sections, is to describe and assess this linear trend.
      </p>
    </subsection>

    <subsection xml:id="subsec-linear-equation">
      <title>Linear Equation</title>
      <p>
        Linear regression describes linear trends in the relation between a response and an explanatory variable. Linear trends may be specified with the aid of linear equations. In this subsection we discuss the relation between a linear equation and a linear trend (a straight line).
      </p>
      <p>
        A linear equation is an equation of the form:
      </p>
      <me>y = a + b \cdot x\;,</me>
      <p>
        where <m>y</m> and <m>x</m> are variables and <m>a</m> and <m>b</m> are the coefficients of the equation. The coefficient <m>a</m> is called the <term>intercept</term> and the coefficient <m>b</m> is called the <term>slope</term>.
      </p>
      <p>
        A linear equation can be used in order to plot a line on a graph. With each value on the <m>x</m>-axis one may associate a value on the <m>y</m>-axis: the value that satisfies the linear equation. The collection of all such pairs of points, all possible <m>x</m> values and their associated <m>y</m> values, produces a straight line in the two-dimensional plane.
      </p>

      <figure xml:id="fig-regression3">
        <caption>Lines</caption>
        <image source="_figures/Regression3.png" width="60%">
          <description>Scatter plot with three lines showing different intercepts and slopes</description>
        </image>
      </figure>

      <p>
        As an illustration consider the three lines in <xref ref="fig-regression3" />. The <em>green</em> line is produced via the equation <m>y = 7 + x</m>, the intercept of the line is 7 and the slope is 1. The <em>blue</em> is a result of the equation <m>y = 14 - 2 x</m>. For this line the intercept is 14 and the slope is -2. Finally, the <em>red</em> line is produced by the equation <m>y = 8.97</m>. The intercept of the line is 8.97 and the slope is equal to 0.
      </p>
      <p>
        The intercept describes the value of <m>y</m> when the line crosses the <m>y</m>-axis. Equivalently, it is the result of the application of the linear equation for the value <m>x=0</m>. Observe in <xref ref="fig-regression3" /> that the <em>green</em> line crosses the <m>y</m>-axis at the level <m>y=7</m>. Likewise, the <em>blue</em> line crosses the <m>y</m>-axis at the level <m>y=14</m>. The <em>red</em> line stays constantly at the level <m>y=8.97</m>, and this is also the level at which it crosses the <m>y</m>-axis.
      </p>
      <p>
        The slope is the change in the value of <m>y</m> for each unit change in the value of <m>x</m>. Consider the <em>green</em> line. When <m>x=0</m> the value of <m>y</m> is <m>y=7</m>. When <m>x</m> changes to <m>x=1</m> then the value of <m>y</m> changes to <m>y=8</m>. A change of one unit in <m>x</m> corresponds to an <em>increase</em> in one unit in <m>y</m>. Indeed, the slope for this line is <m>b=1</m>. As for the <em>blue</em> line, when <m>x</m> changes from 0 to 1 the value of <m>y</m> changes from <m>y=14</m> to <m>y=12</m>; a <em>decrease</em> of two units. This decrease is associated with the slope <m>b=-2</m>. Lastly, for the constant <em>red</em> line there is no change in the value of <m>y</m> when <m>x</m> changes its value from <m>x=0</m> to <m>x=1</m>. Therefore, the slope is <m>b=0</m>. A positive slope is associated with an increasing line, a negative slope is associated with a decreasing line and a zero slope is associated with a constant line.
      </p>
      <p>
        Lines can be considered in the context of scatter plots. <xref ref="fig-regression3" /> contains the scatter plot of the data on the relation between the length of fish and their weight. A regression line is the line that best describes the linear trend of the relation between the explanatory variable and the response. Neither of the lines in the figure is the regression line, although the <em>green</em> line is a better description of the trend than the <em>blue</em> line. The regression line is the best description of the linear trend.
      </p>
      <p>
        The <em>red</em> line is a fixed line that is constructed at a level equal to the average value<fn>Run the expression <c>mean(y)</c> to obtain <m>\bar y = 8.97</m> as the value of the sample average.</fn> of the variable <m>y</m>. This line partly reflects the information in the data. The regression line, which we fit in the next section, reflects more of the information by including a description of the trend in the data.
      </p>
      <p>
        Lastly, let us see how one can add lines to a plot in <c>R</c>. Functions to produce plots in <c>R</c> can be divided into two categories: high level and low level plotting functions. High level functions produce an entire plot, including the axes and the labels of the plot. The plotting functions that we encountered in the past such as <q><c>plot</c></q>, <q><c>hist</c></q>, <q><c>boxplot</c></q> and the like are all high level plotting functions. Low level functions, on the other hand, add features to an existing plot.
      </p>
      <p>
        An example of a low level plotting function is the function <q><c>abline</c></q>. This function adds a straight line to an existing plot. The first argument to the function is the intercept of the line and the second argument is the slope of the line. Other arguments may be used in order to specify the characteristics of the line. For example, the argument <c>col=<em>color.name</em></c> may be used in order to change the color of the line from its default black color. A plot that is very similar to plot in <xref ref="fig-regression3" /> may be produced with the following code<fn>The actual plot in <xref ref="fig-regression3" /> is produced by a slightly modified code. First an empty plot is produced with the expression <c>plot(c(0,5),c(5,15),type=n,xlab=x,ylab=y)</c> and then the points are added with the expression <c>points(y~x)</c>. The lines are added as in the text. Finally, a legend is added with the function <c>legend</c>.</fn>:
      </p>

      <program language="r">
        <input>
plot(y~x)
abline(7,1,col="green")
abline(14,-2,col="blue")
abline(mean(y),0,col="red")
        </input>
      </program>
      <figure xml:id="fig-regression3a">
        <caption>A Scatter Plot</caption>
        <image source="_figures/Regression3a.png" width="60%">
          <description>Scatter plot showing relationship between fish length (x-axis) and weight (y-axis)</description>
        </image>
      </figure>
      <p>
        Initially, the scatter plot is created and the lines are added to the plot one after the other. Observe that color of the first line that is added is green, it has an intercept of 7 and a slope of 1. The second line is blue, with an intercept of 14 and a negative slope of -2. The last line is red, and its constant value is the average of the variable <m>y</m>.
      </p>
      <p>
        In the next section we discuss the computation of the regression line, the line that describes the linear trend in the data. This line will be added to scatter plots with the aid of the function <q><c>abline</c></q>.
      </p>
    </subsection>
  </section>

  <section xml:id="sec-least-squares">
    <title>Linear Regression</title>
    <p>
      Data that describes the joint distribution of two numeric variables can be represented with a scatter plot. The <m>y</m>-axis in this plot corresponds to the response and the <m>x</m>-axis corresponds to the explanatory variable. The regression line describes the linear trend of the response as a function of the explanatory variable. This line is characterized by a linear equation with an intercept and a slope that are computed from the data.
    </p>
    <p>
      In the first subsection we present the computation of the regression linear equation from the data. The second subsection discusses regression as a statistical model. Statistical inference can be carried out on the basis of this model. In the context of the statistical model, one may consider the intercept and the slope of the regression model that is fitted to the data as point estimates of the model's parameter. Based on these estimates, one may test hypotheses regarding the regression model and construct confidence intervals for parameters.
    </p>

    <subsection xml:id="subsec-fitting-regression-line">
      <title>Fitting the Regression Line</title>
      <p>
        The <c>R</c> function that fits the regression line to data is called <q><c>lm</c></q>, an acronym for <em>Linear Model</em>. The input to the function is a formula, with the response variable to the left of the tilde character and the explanatory variable to the right of it. The output of the function is the fitted linear regression model.
      </p>
      <p>
        Let us apply the linear regression function to the data on the weight and the length of fish. The output of the function is saved by us in a object called <q><c>fit</c></q>. Subsequently, the content of the object <q><c>fit</c></q> is displayed:
      </p>

      <program language="r">
        <input>
fit &lt;- lm(y~x)
fit
        </input>
      </program>

      <pre>
## 
## Call:
## lm(formula = y ~ x)
## 
## Coefficients:
## (Intercept)            x  
##       4.616        1.427
      </pre>

      <p>
        When displayed, the output of the function <q><c>lm</c></q> shows the formula that was used by the function and provides the coefficients of the regression linear equation. Observe that the intercept of the line is equal to 4.616. The slope of the line, the coefficient that multiplies <q><c>x</c></q> in linear equation, is equal to 1.427.
      </p>
      <p>
        One may add the regression line to the scatter plot with the aid of the function <q><c>abline</c></q>:
      </p>

      <program language="r">
        <input>
plot(y~x)
abline(fit)
        </input>
      </program>

      <figure xml:id="fig-regression4">
        <caption>A Fitted Regression Line</caption>
        <image source="_figures/Regression4.png" width="60%">
          <description>Scatter plot with fitted regression line showing the linear relationship</description>
        </image>
      </figure>

      <p>
        The first expression produces the scatter plot of the data on fish. The second expression adds the regression line to the scatter plot. When the input to the graphical function <q><c>abline</c></q> is the output of the function <q><c>lm</c></q> that fits the regression line, then the result is the addition of the regression line to the existing plot. The line that is added is the line characterized by the coefficients that are computed by the function <q><c>lm</c></q>. The coefficients in the current setting are 4.616 for the intercept and 1.427 for the slope.
      </p>
      <p>
        The scatter plot and the added regression line are displayed in <xref ref="fig-regression4" />. Observe that line passes through the points, balancing between the points that are above the line and the points that are below. The line captures the linear trend in the data.
      </p>
      <p>
        Examine the line in <xref ref="fig-regression4" />. When <m>x=1</m> then the <m>y</m> value of the line is slightly above 6. When the value of <m>x</m> is equal to 2, a change of one unit, then value of <m>y</m> is below 8, and is approximately equal to 7.5. This observation is consistent with the fact that the slop of the line is 1.427. The value of <m>x</m> is decreased by 1 when changing from <m>x=1</m> to <m>x=0</m>. Consequently, the value of <m>y</m> when <m>x=0</m> should decrease by 1.427 in comparison to its value when <m>x=1</m>. The value at <m>x=1</m> is approximately 6. Therefore, the value at <m>x=0</m> should be approximately 4.6. Indeed, we do get that the intercept is equal to 4.616.
      </p>
      <p>
        The coefficients of the regression line are computed from the data and are hence statistics. Specifically, the slope of the regression line is computed as the ratio between the <em>covariance</em> of the response and the explanatory variable, divided by the variance of the explanatory variable. The intercept of the regression line is computed using the sample averages of both variables and the computed slope.
      </p>
      <p>
        Start with the slope. The main ingredient in the formula for the slope, the numerator in the ratio, is the covariance between the two variables. The covariance measures the joint variability of two variables. Recall that the formula for the sample variance of the variable <m>x</m> is equal to:
      </p>
      <me>s^2 = \frac{\mbox{Sum of the squares of the deviations}}{\mbox{Number of values in the sample}-1} = \frac{\sum_{i=1}^n (x_i - \bar x)^2}{n-1}\;.</me>
      <p>
        The formula of the sample covariance between <m>x</m> and <m>y</m> replaces the square of the deviations by the product of deviations. The product is between an <m>y</m> deviation and the parallel <m>x</m> deviation:
      </p>
      <me>\mbox{covariance} = \frac{\mbox{Sum of products of the deviations}}{\mbox{Number of values in the sample}-1} = \frac{\sum_{i=1}^n (y_i-\bar y)(x_i - \bar x)}{n-1}\;.</me>
      <p>
        The function <q><c>cov</c></q> computes the sample covariance between two numeric variables. The two variables enter as arguments to the function and the sample covariance is the output. Let us demonstrate the computation by first applying the given function to the data on fish and then repeating the computations without the aid of the function:
      </p>

      <program language="r">
        <input>
cov(y,x)
sum((y-mean(y))*(x-mean(x)))/9
        </input>
      </program>

      <pre>
## [1] 2.386111
## [1] 2.386111
      </pre>

      <p>
        In both cases we obtained the same result. Notice that the sum of products of deviations in the second expression was divided by 9, which is the number of observations, minus 1.
      </p>
      <p>
        The slope of the regression line is the ratio between the covariance and the variance of the explanatory variable.
      </p>
      <p>
        The regression line passes through the point <m>(\bar x, \bar y)</m>, a point that is determined by the means of the both the explanatory variable and the response. It follows that the intercept should obey the equation:
      </p>
      <me>\bar y = a + b\cdot \bar x \quad\Longrightarrow\quad a = \bar y - b\cdot \bar x\;,</me>
      <p>
        The left-hand-side equation corresponds to the statement that the value of the regression line at the average <m>\bar x</m> is equal to the average of the response <m>\bar y</m>. The right-hand-side equation is the solution to the left-hand-side equation.
      </p>
      <p>
        One may compute the coefficients of the regression model manually by computing first the slope as a ratio between the covariance and the variance of explanatory variable. The intercept can then be obtained by the equation that uses the computed slope and the averages of both variables:
      </p>

      <program language="r">
        <input>
b &lt;- cov(x,y)/var(x)
a &lt;- mean(y) - b*mean(x)
a
b
        </input>
      </program>

      <pre>
## [1] 4.616539
## [1] 1.427396
      </pre>

      <p>
        Applying the manual method we obtain, after rounding up, the same coefficients that were produced by the application of the function <q><c>lm</c></q> to the data.
      </p>
      <p>
        As an exercise, let us fit the regression model to the data on the relation between the response <q><c>horsepower</c></q> and the explanatory variable <q><c>engine.size</c></q>. Apply the function <q><c>lm</c></q> to the data and present the results:
      </p>

      <program language="r">
        <input>
fit.power &lt;- lm(horsepower ~ engine.size, data=cars)
fit.power
        </input>
      </program>

      <pre>
## 
## Call:
## lm(formula = horsepower ~ engine.size, data = cars)
## 
## Coefficients:
##  (Intercept)   engine.size  
##        6.641         0.770
      </pre>

      <p>
        The fitted regression model is stored in an object called <q><c>fit.power</c></q>. The intercept in the current setting is equal to 6.6414 and the slope is equal to 0.7695.
      </p>
      <p>
        Observe that one may refer to variables that belong to a data frame, provided that the name of the data frame is entered as the value of the argument <q><c>data</c></q> in the function <q><c>lm</c></q>. Here we refer to variables that belong to the data frame <q><c>cars</c></q>.
      </p>
      <p>
        Next we plot the scatter plot of the data and add the regression line:
      </p>

      <program language="r">
        <input>
plot(horsepower ~ engine.size, data=cars)
abline(fit.power)
        </input>
      </program>

      <figure xml:id="fig-regression5">
        <caption>A Regression Model of Power versus Engine Size</caption>
        <image source="_figures/Regression5.png" width="60%">
          <description>Scatter plot with regression line showing relationship between engine size and horsepower</description>
        </image>
      </figure>

      <p>
        The output of the plotting functions is presented in <xref ref="fig-regression5" />. Again, the regression line describes the general linear trend in the data. Overall, with the increase in engine size one observes increase in the power of the engine.
      </p>
    </subsection>

  <subsection xml:id="sec-regression-inference">
    <title>Inference</title>
    
    <p>
      Up to this point we have been considering the regression model in the context of descriptive statistics. The aim in fitting the regression line to the data was to characterize the linear trend observed in the data. Our next goal is to deal with regression in the context of inferential statistics. The goal here is to produce statements on characteristics of an entire population on the basis of the data contained in the sample.
    </p>
    
    <p>
      The foundation for statistical inference in a given setting is a statistical model that produces the sampling distribution in that setting. The sampling distribution is the frame of reference for the analysis. In this context, the observed sample is a single realization of the sampling distribution, one realization among infinitely many potential realizations that never take place. The setting of regression involves a response and an explanatory variable. We provide a description of the statistical model for this setting.
    </p>
    
    <p>
      The relation between the response and the explanatory variable is such that the value of the later affects the distribution of the former. Still, the value of the response is not uniquely defined by the value of the explanatory variable. This principle also hold for the regression model of the relation between the response <m>Y</m> and the explanatory variable <m>X</m>. According to the model of linear regression the value of the <term>expectation</term> of the response for observation <m>i</m>, <m>\Expec(Y_i)</m>, is a linear function of the value of the explanatory variable for the same observation. Hence, there exist and intercept <m>a</m> and a slope <m>b</m>, common for all observations, such that if <m>X_i = x_i</m> then
    </p>
    
    <me>\Expec(Y_i) = a + b \cdot x_i\;.</me>
    
    <p>
      The regression line can thus be interpreted as the average trend of the response in the population. This average trend is a linear function of the explanatory variable.
    </p>
    
    <p>
      The intercept <m>a</m> and the slope <m>b</m> of the statistical model are parameters of the sampling distribution. One may test hypotheses and construct confidence intervals for these parameters based on the observed data and in relation to the sampling distribution.
    </p>
    
    <p>
      Consider testing hypothesis. A natural null hypothesis to consider is the hypothesis that the slope is equal to zero. This hypothesis corresponds to statement that the expected value of the response is constant for all values of the explanatory variable. In other words, the hypothesis is that the explanatory variable does not affect the distribution of the response<fn>According to the model of linear regression, the only effect of the explanatory variable on the distribution of the response is via the expectation. If such an effect, according to the null hypothesis, is also excluded then the so called explanatory variable is not effecting at all the distribution of the response.</fn>. One may formulate this null hypothesis as <m>H_0:b = 0</m> and test it against the alternative <m>H_1: b \not= 0</m> that states that the explanatory variable does affect the distribution of the response.
    </p>
    
    <p>
      A test of the given hypotheses can be carried out by the application of the function <q><c>summary</c></q> to the output of the function <q><c>lm</c></q>. Recall that the function <q><c>lm</c></q> was used in order to fit the linear regression to the data. In particular, this function was applied to the data on the relation between the size of the engine and the power that the engine produces. The function fitted a regression line that describes the linear trend of the data. The output of the function was saved in an object by the name <q><c>fit.power</c></q>. We apply the function <q><c>summary</c></q> to this object:
    </p>
    
    <program language="r">
      <input>
summary(fit.power)
      </input>
    </program>
    <pre>
## 
## Call:
## lm(formula = horsepower ~ engine.size, data = cars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -59.643 -12.282  -5.515  10.251 125.153 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  6.64138    5.23318   1.269    0.206    
## engine.size  0.76949    0.03919  19.637   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 23.31 on 201 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.6574, Adjusted R-squared:  0.6556 
## F-statistic: 385.6 on 1 and 201 DF,  p-value: &lt; 2.2e-16
</pre>
    <p>
      The output produced by the application of the function <q><c>summary</c></q> is long and detailed. We will discuss this output in the next section. Here we concentrate on the table that goes under the title <q><c>Coefficients:</c></q>. The said table is made of 2 rows and 4 columns. It contains information for testing, for each of the coefficients, the null hypothesis that the value of the given coefficient is equal to zero. In particular, the second row may be used is order to test this hypothesis for the slope of the regression line, the coefficient that multiplies the explanatory variable.
    </p>
    
    <p>
      Consider the second row. The first value on this row is 0.76949, which is equal (after rounding up) to the slope of the line that was fitted to the data in the previous subsection. However, in the context of statistical inference this value is the <term>estimate</term> of the slope of the population regression coefficient, the realization of the estimator of the slope<fn>The estimator of the slope is obtained via the application of the formula for the computation of the slope to the sample: <m>\frac{1}{n-1}\sum_{i=1}^n (Y_i-\bar Y)(X_i - \bar X)/\frac{1}{n-1}\sum_{i=1}^n (X_i - \bar X)^2</m>.</fn>.
    </p>
    
    <p>
      The second value is 0.03919. This is an estimate of the standard deviation of the estimator of the slope. The third value is the test statistic. This statistic is the ratio between the deviation of the sample estimate of the parameter (0.76949) from the value of the parameter under the null hypothesis (0), divided by the estimated standard deviation (0.03919): <m>(0.76949 - 0)/0.03919 = 0.76949/0.03919  = 19.63486</m>, which is essentially the value given in the report<fn>Our computation involves rounding up errors, hence the small discrepancy between the value we computed and the value in the report.</fn>.
    </p>
    
    <p>
      The last value is the computed <m>p</m>-value for the test. It can be shown that the sampling distribution of the given test statistic, under the null distribution which assumes no slope, is asymptotically the standard Normal distribution. If the distribution of the response itself is Normal then the distribution of the statistic is the <m>t</m>-distribution on <m>n-2</m> degrees of freedom. In the current situation this corresponds to 201 degrees of freedom<fn>Notice that the <q><c>horsepower</c></q> measurement is missing for two observation. These observations are deleted for the analysis, leaving a total of <m>n=203</m> observations. The number of degrees of freedom is <m>n-2 = 203-2=201</m>.</fn>. The computed <m>p</m>-value is extremely small, practically eliminating the possibility that the slope is equal to zero.
    </p>
    
    <p>
      The first row presents information regarding the intercept. The estimated intercept is 6.64138 with an estimated standard deviation of 5.23318. The value of the test statistic is 1.269 and the <m>p</m>-value for testing the null hypothesis that the intercept is equal to zero against the two sided alternative is 0.206. In this case the null hypothesis is not rejected since the <m>p</m>-value is larger than 0.05.
    </p>
    
    <p>
      The report contains an inference for the intercept. However, one is advised to take this inference in the current case with a grain of salt. Indeed, the intercept is the expected value of the response when the explanatory variable is equal to zero. Here the explanatory variable is the size of the engine and the response is the power of that engine. The power of an engine of size zero is a quantity that has no physical meaning! In general, unless the intercept is in the range of observations (i.e. the value 0 is in the range of the observed explanatory variable) one should treat the inference on the intercept cautiously. Such inference requires extrapolation and is sensitive to the miss-specification of the regression model.
    </p>
    
    <p>
      Apart from testing hypotheses one may also construct confidence intervals for the parameters. A crude confidence interval may be obtained by taking 1.96 standard deviations on each side of the estimate of the parameter. Hence, a confidence interval for the slope is approximately equal to <m>0.76949 \pm 1.96\times 0.03919 = [0.6926776, 0.8463024]</m>. In a similar way one may obtain a confidence interval for the slope<fn>The warning message that was made in the context of testing hypotheses on the intercept should be applied also to the construction of confidence intervals. If the value 0 is not in the range of the explanatory variable then one should be careful when interpreting a confidence interval for the intercept.</fn>: <m>6.64138 \pm 1.96\times 5.23318  = [-3.615653, 16.89841]</m>.
    </p>
    
    <p>
      Alternatively, one may compute confidence intervals for the parameters of the linear regression model using the function <q><c>confint</c></q>. The input to this function is the fitted model and the output is a confidence interval for each of the parameters:
    </p>
    
    <program language="r">
      <input>
confint(fit.power)
      </input>
    </program>
    <pre>
##                  2.5 %     97.5 %
## (Intercept) -3.6775989 16.9603564
## engine.size  0.6922181  0.8467537
</pre>
    <p>
      Observe the similarity between the confidence intervals that are computed by the function and the crude confidence intervals that were produced by us. The small discrepancies that do exist between the intervals result from the fact that the function <q><c>confint</c></q> uses the <m>t</m>-distribution whereas we used the Normal approximation.
    </p>
    
    <subsection xml:id="subsec-rsquared-variance-residuals">
      <title>R-squared and the Variance of Residuals</title>
      
      <p>
        In this section we discuss the residuals between the values of the response and their estimated expected value according to the regression model. These residuals are the regression model equivalence of the deviations between the observations and the sample average. We use these residuals in order compute the variability that is not accounted for by the regression model. Indeed, the ratio between the total variability of the residuals and the total variability of the deviations from the average serves as a measure of the variability that is not explained by the explanatory variable. R-squared, which is equal to 1 minus this ratio, is interpreted as the fraction of the variability of the response that is explained by the regression model.
      </p>
      
      <p>
        We start with the definition of residuals. Let us return to the artificial example that compared length of fish to their weight. The data for this example was given in <xref ref="table-regression-1" /> and was saved in the objects <q><c>x</c></q> and <q><c>y</c></q>. The regression model was fitted to this data by the application of the function <q><c>lm</c></q> to the formula <q><c>y~x</c></q> and the fitted model was saved in an object called <q><c>fit</c></q>. Let us apply the function <q><c>summary</c></q> to the fitted model:
      </p>
      
      <program language="r">
        <input>
summary(fit)
        </input>
      </program>
      
      <p>
        The given report contains a table with estimates of the regression coefficients and information for conducting hypothesis testing. The report contains other information that is associated mainly with the notion of the residuals from regression line. Our current goal is to understand what is that other information.
      </p>
      
      <p>
        The residual from regression for each observation is the difference between the value of the response for the observation and the estimated expectation of the response under the regression model<fn>The estimated expectation of the response is also called <term>the predicted response</term>.</fn>. An observation is a pair <m>(x_i,y_i)</m>, with <m>y_i</m> being the value of the response. The expectation of the response according to the regression model is <m>a + b \cdot x_i</m>, where <m>a</m> and <m>b</m> are the coefficients of the model. The estimated expectation is obtained by using, in the formula for the expectation, the coefficients that are estimated from the data. The residual is the difference between <m>y_i</m> and <m>a + b \cdot x_i</m>.
      </p>
      
      <p>
        Consider an example. The first observation on the fish is <m>(4.5, 9.5)</m>, where <m>x_1 = 4.5</m> and <m>y_1 = 9.5</m>. The estimated intercept is 4.6165 and the estimated slope is 1.4274. The estimated expectation of the response for the first variable is equal to
      </p>
      
      <me>4.6165 + 1.4274 \cdot x_1 = 4.6165 + 1.4274 \cdot 4.5  =  11.0398\;.</me>
      
      <p>
        The residual is the difference between the observes response and this value:
      </p>
      
      <me>y_1 - (4.6165 + 1.4274 \cdot x_1) = 9.5 - 11.0398 = -1.5398\;.</me>
      
      <p>
        The residuals for the other observations are computed in the same manner. The values of the intercept and the slope are kept the same but the values of the explanatory variable and the response are changed.
      </p>
      
      <figure xml:id="fig-regression7">
        <caption>Residuals and Deviations from the Mean</caption>
        <image source="_figures/Regression6.png" width="60%">
          <description>Two scatter plots showing residuals from regression line (upper) and deviations from mean (lower)</description>
        </image>
      </figure>
      
      <p>
        Consult the upper plot in <xref ref="fig-regression7" />. This is a scatter plot of the data, together with the regression line in <em>black</em> and the line of the average in <em>red</em>. A vertical arrow extends from each data point to the regression line. The point where each arrow hits the regression line is associated with the estimated value of the expectation for that point. The residual is the difference between the value of the response at the origin of the arrow and the value of the response at the tip of its head. Notice that there are as many residuals as there are observations.
      </p>
      
      <p>
        The function <q><c>residuals</c></q> computes the residuals. The input to the function is the fitted regression model and the output is the sequence of residuals. When we apply the function to the object <q><c>fit</c></q>, which contains the fitted regression model for the fish data, we get the residuals:
      </p>
      
      <program language="r">
        <input>
residuals(fit)
        </input>
      </program>
      
      <p>
        Indeed, 10 residuals are produced, one for each observation. In particular, the residual for the first observation is -1.5397075, which is essentially the value that we obtained<fn>The discrepancy between the value that we computed and the value computed by the function results from rounding up errors. We used the vales of the coefficients that appear in the report. These values are rounded up. The function <q><c>residuals</c></q> uses the coefficients without rounding.</fn>.
      </p>
      
      <p>
        Return to the report produced by the application of the function <q><c>summary</c></q> to the fitted regression model. The first component in the report is the formula that identifies the response and the explanatory variable. The second component, the component that comes under the title <q><c>Residuals:</c></q>, gives a summary of the distribution of the residuals. This summary includes the smallest and the largest values in the sequence of residuals, as well as the first and third quartiles and the median. The average is not reported since the average of the residuals from the regression line is always equal to 0.
      </p>
      
      <p>
        The table that contains information on the coefficients was discussed in the previous section. Let us consider the last 3 lines of the report.
      </p>
      
      <p>
        The first of the three lines contains the estimated value of the standard deviation of the response from the regression model. If the expectations of the measurements of the response are located on the regression line then the variability of the response corresponds to the variability about this line. The resulting variance is estimated by the sum of squares of the residuals from the regression line, divided by the number of observations minus 2. A division by the number of observation minus 2 produces an unbiased estimator of the variance of the response about the regression model. Taking the square root of the estimated variance produces an estimate of the standard deviation:
      </p>
      
      <program language="r">
        <input>
sqrt(sum(residuals(fit)^2)/8)
        </input>
      </program>
      
      <p>
        The last computation is a manual computation of the estimated standard deviation. It involves squaring the residuals and summing the squares. This sum is divided by the number of observations minus 2 (<m>10-2=8</m>). Taking the square root produces estimate. The value that we get for the estimated standard deviation is 2.790787, which coincides with the value that appears in the first of the last 3 lines of the report.
      </p>
      
      <p>
        The second of these lines reports the R-squared of the linear fit. In order to explain the meaning of R-squared let us consider <xref ref="fig-regression7" /> once again. The two plots in the figure present the scatter plot of the data together with the regression line and the line of the average. Vertical <em>black</em> arrows that represent the residuals from the regression are added to the upper plot. The lower plot contains vertical <em>red</em> arrows that extend from the data points to the line of the average. These arrows represent the deviations of the response from the average.
      </p>
      
      <p>
        Consider two forms of variation. One form is the variation of the response from its average value. This variation is summarized by the sample variance, the sum of the squared lengths of the <term>red</term> arrows divided by the number of observations minus 1. The other form of variation is the variation of the response from the fitted regression line. This variation is summarized by the sample variation of the residuals, the sum of squared lengths of the <term>black</term> arrows divided by the number of observations minus 1. The ratio between these two quantities gives the relative variability of the response that remains after fitting the regression line to the data.
      </p>
      
      <p>
        The line of the average is a straight line. The deviations of the observations from this straight line can be thought of as residuals from that line. The variability of these residuals, the sum of squares of the deviations from the average divided by the number of observations minus 1, is equal to the sample variance.
      </p>
      
      <p>
        The regression line is the unique straight line that minimizes the variability of its residuals. Consequently, the variability of the residuals from the regression, the sum of squares of the residuals from the regression divided by the number of observations minus 1, is the smallest residual variability produced by any straight line. It follows that the sample variance of the regression residuals is less than the sample variance of the response. Therefore, the ratio between the variance of the residuals and the variance of the response is less than 1.
      </p>
      
      <p>
        R-squared is the difference between 1 and the ratio of the variances. Its value is between 0 and 1 and it represents the fraction of the variability of the response that is <em>explained</em> by the regression line. The closer the points are to the regression line the larger the value of R-squared becomes. On the other hand, the less there is a linear trend in the data the closer to 0 is the value of R-squared. In the extreme case of R-squared equal to 1 all the data point are positioned exactly on a single straight line. In the other extreme, a value of 0 for R-squared implies no linear trend in the data.
      </p>
      
      <p>
        Let us compute manually the difference between 1 and the ratio between the variance of the residuals and the variance of the response:
      </p>
      
      <program language="r">
        <input>
1-var(residuals(fit))/var(y)
        </input>
      </program>
      
      <p>
        Observe that the computed value of R-squared is the same as the value <q><c>Multiple R-squared: 0.4281</c></q> that is given in the report.
      </p>
      
      <p>
        The report provides another value of R-squared, titled <term>Adjusted R-squared</term>. The difference between the adjusted and unadjusted quantities is that in the former the sample variance of the residuals from the regression is replaced by an unbiased estimate of the variability of the response about the regression line. The sum of squares in the unbiased estimator is divided by the number of observations minus 2. Indeed, when we re-compute the ratio using the unbiased estimate, the sum of squared residuals divided by <m>10 - 2 = 8</m>, we get:
      </p>
      
      <program language="r">
        <input>
1-(sum(residuals(fit)^2)/8)/var(y)
        </input>
      </program>
      
      <p>
        The value of this adjusted quantity is equal to the value <q><c>Adjusted R-squared: 0.3566</c></q> in the report.
      </p>
      
      <p>
        Which value of R-squared to use is a matter of personal taste. In any case, for a larger number of observations the difference between the two values becomes negligible.
      </p>
      
      <p>
        The last line in the report produces an overall goodness of fit test for the regression model. In the current application of linear regression this test reduces to a test of the slope being equal to zero, the same test that is reported in the second row of the table of coefficients<fn>In more complex applications of linear regression, applications that are not considered in this book, the test in the last line of the report and the tests of coefficients do not coincide.</fn>. The <m>F</m> statistic is simply the square of the <m>t</m> value that is given in the second row of the table. The sampling distribution of this statistic under the null hypothesis is the <m>F</m>-distribution on 1 and <m>n-2</m> degrees of freedom, which is the sampling distribution of the square of the test statistic for the slope. The computed <m>p</m>-value, <q><c>p-value: 0.04003</c></q> is the identical (after rounding up) to the <m>p</m>-value given in the second line of the table.
      </p>
      
      <p>
        Return to the R-squared coefficient. This coefficient is a convenient measure of the goodness of fit of the regression model to the data. Let us demonstrate this point with the aid of the <q><c>cars</c></q> data. In Subsection <xref ref="subsec-fitting-regression-line" /> we fitted a regression model to the power of the engine as a response and the size of the engine as an explanatory variable. The fitted model was saved in the object called <q><c>fit.power</c></q>. A report of this fit, the output of the expression <q><c>summary(fit.power)</c></q> was also presented. The null hypothesis of zero slope was clearly rejected. The value of R-squared for this fit was 0.6574. Consequently, about 2/3 of the variability in the power of the engine is explained by the size of the engine.
      </p>
      
      <p>
        Consider trying to fit a different regression model for the power of the engine as a response. The variable <q><c>length</c></q> describes the length of the car (in inches). How well would the length explain the power of the car? We may examine this question using linear regression:
      </p>
      
      <program language="r">
        <input>
summary(lm(horsepower ~ length, data=cars))
        </input>
      </program>
      
      <p>
        We used one expression to fit the regression model to the data and to summarize the outcome of the fit.
      </p>
      
      <p>
        A scatter plot of the two variables together with the regression line may be produced using the code:
      </p>
      
      <program language="r">
        <input>
plot(horsepower ~ length, data=cars)
abline(lm(horsepower ~ length, data=cars))
        </input>
      </program>
      
      <p>
        From the examination of the figure we may see that indeed there is a linear trend in the relation between the length and the power of the car. Longer cars tend to have more power. Testing the null hypothesis that the slope is equal to zero produces a very small <m>p</m>-value and leads to the rejection of the null hypothesis.
      </p>
      
      <p>
        The length of the car and the size of the engine are both statistically significant in their relation to the response. However, which of the two explanatory variables produces a better fit?
      </p>
      
      <p>
        An answer to this question may be provided by the examination of values of R-squared, the ratio of the variance of the response explained by each of the explanatory variable. The R-squared for the size of the engine as an explanatory variable is 0.6574, which is approximately equal to 2/3. The value of R-squared for the length of the car as an explanatory variable is 0.308, less than 1/3. It follows that the size of the engine explains twice as much of the variability of the power of the engine than the size of car and is a better explanatory variable.
      </p>
    </subsection>
</section>

    <section xml:id="subsec-r-squared">
      <title>R-squared and the Variance of Residuals</title>
      <p>
        In this section we discuss the residuals between the values of the response and their estimated expected value according to the regression model. These residuals are the regression model equivalence of the deviations between the observations and the sample average. We use these residuals in order compute the variability that is not accounted for by the regression model. Indeed, the ratio between the total variability of the residuals and the total variability of the deviations from the average serves as a measure of the variability that is not explained by the explanatory variable. R-squared, which is equal to 1 minus this ratio, is interpreted as the fraction of the variability of the response that is explained by the regression model.
      </p>
      <p>
        We start with the definition of residuals. Let us return to the artificial example that compared length of fish to their weight. The data for this example was given in <xref ref="table-regression-1" /> and was saved in the objects <q><c>x</c></q> and <q><c>y</c></q>. The regression model was fitted to this data by the application of the function <q><c>lm</c></q> to the formula <c>y~x</c> and the fitted model was saved in an object called <q><c>fit</c></q>. Let us apply the function <q><c>summary</c></q> to the fitted model:
      </p>

      <program language="r">
        <input>
summary(fit)
        </input>
      </program>

      <pre>
## 
## Call:
## lm(formula = y ~ x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.0397 -2.1388 -0.6559  1.8518  4.0595 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)  
## (Intercept)   4.6165     2.3653   1.952   0.0868 .
## x             1.4274     0.7195   1.984   0.0826 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.791 on 8 degrees of freedom
## Multiple R-squared:  0.3297, Adjusted R-squared:  0.246 
## F-statistic: 3.936 on 1 and 8 DF,  p-value: 0.08255
      </pre>

      <p>
        The given report contains a table with estimates of the regression coefficients and information for conducting hypothesis testing. The report contains other information that is associated mainly with the notion of the residuals from regression line. Our current goal is to understand what is that other information.
      </p>
      <p>
        The residual from regression for each observation is the difference between the value of the response for the observation and the estimated expectation of the response under the regression model<fn>The estimated expectation of the response is also called <em>the predicted response</em>.</fn>. An observation is a pair <m>(x_i,y_i)</m>, with <m>y_i</m> being the value of the response. The expectation of the response according to the regression model is <m>a + b \cdot x_i</m>, where <m>a</m> and <m>b</m> are the coefficients of the model. The estimated expectation is obtained by using, in the formula for the expectation, the coefficients that are estimated from the data. The residual is the difference between <m>y_i</m> and <m>a + b \cdot x_i</m>.
      </p>
      <p>
        Consider an example. The first observation on the fish is <m>(4.5, 9.5)</m>, where <m>x_1 = 4.5</m> and <m>y_1 = 9.5</m>. The estimated intercept is 4.6165 and the estimated slope is 1.4274. The estimated expectation of the response for the first variable is equal to
      </p>
      <me>4.6165 + 1.4274 \cdot x_1 = 4.6165 + 1.4274 \cdot 4.5  =  11.0398\;.</me>
      <p>
        The residual is the difference between the observes response and this value:
      </p>
      <me>y_1 - (4.6165 + 1.4274 \cdot x_1) = 9.5 - 11.0398 = -1.5398\;.</me>
      <p>
        The residuals for the other observations are computed in the same manner. The values of the intercept and the slope are kept the same but the values of the explanatory variable and the response are changed.
      </p>

      <figure xml:id="fig-regression6">
        <caption>Residuals and Deviations from the Mean</caption>
        <image source="_figures/Regression6.png" width="60%">
          <description>Two scatter plots showing residuals from regression line and deviations from mean</description>
        </image>
      </figure>

      <p>
        Consult the upper plot in <xref ref="fig-regression6" />. This is a scatter plot of the data, together with the regression line in <em>black</em> and the line of the average in <em>red</em>. A vertical arrow extends from each data point to the regression line. The point where each arrow hits the regression line is associated with the estimated value of the expectation for that point. The residual is the difference between the value of the response at the origin of the arrow and the value of the response at the tip of its head. Notice that there are as many residuals as there are observations.
      </p>
      <p>
        The function <q><c>residuals</c></q> computes the residuals. The input to the function is the fitted regression model and the output is the sequence of residuals. When we apply the function to the object <q><c>fit</c></q>, which contains the fitted regression model for the fish data, we get the residuals:
      </p>

      <program language="r">
        <input>
residuals(fit)
        </input>
      </program>

      <pre>
##          1          2          3          4          5          6 
## -1.5397075 -1.6977999 -2.2857694  0.2279229  3.7158923  4.0594616 
##          7          8          9         10 
## -2.5849385 -3.0397075  2.1312463  1.0133998
      </pre>

      <p>
        Indeed, 10 residuals are produced, one for each observation. In particular, the residual for the first observation is -1.5397075, which is essentially the value that we obtained<fn>The discrepancy between the value that we computed and the value computed by the function results from rounding up errors. We used the vales of the coefficients that appear in the report. These values are rounded up. The function <c>residuals</c> uses the coefficients without rounding.</fn>.
      </p>
      <p>
        Return to the report produced by the application of the function <q><c>summary</c></q> to the fitted regression model. The first component in the report is the formula that identifies the response and the explanatory variable. The second component, the component that comes under the title <q>Residuals:</q>, gives a summary of the distribution of the residuals. This summary includes the smallest and the largest values in the sequence of residuals, as well as the first and third quartiles and the median. The average is not reported since the average of the residuals from the regression line is always equal to 0.
      </p>
      <p>
        The table that contains information on the coefficients was discussed in the previous section. Let us consider the last 3 lines of the report.
      </p>
      <p>
        The first of the three lines contains the estimated value of the standard deviation of the response from the regression model. If the expectations of the measurements of the response are located on the regression line then the variability of the response corresponds to the variability about this line. The resulting variance is estimated by the sum of squares of the residuals from the regression line, divided by the number of observations minus 2. A division by the number of observation minus 2 produces an unbiased estimator of the variance of the response about the regression model. Taking the square root of the estimated variance produces an estimate of the standard deviation:
      </p>

      <program language="r">
        <input>
sqrt(sum(residuals(fit)^2)/8)
        </input>
      </program>

      <pre>
## [1] 2.790787
      </pre>

      <p>
        The last computation is a manual computation of the estimated standard deviation. It involves squaring the residuals and summing the squares. This sum is divided by the number of observations minus 2 (<m>10-2=8</m>). Taking the square root produces estimate. The value that we get for the estimated standard deviation is 2.790787, which coincides with the value that appears in the first of the last 3 lines of the report.
      </p>
      <p>
        The second of these lines reports the R-squared of the linear fit. In order to explain the meaning of R-squared let us consider <xref ref="fig-regression6" /> once again. The two plots in the figure present the scatter plot of the data together with the regression line and the line of the average. Vertical <em>black</em> arrows that represent the residuals from the regression are added to the upper plot. The lower plot contains vertical <em>red</em> arrows that extend from the data points to the line of the average. These arrows represent the deviations of the response from the average.
      </p>
      <p>
        Consider two forms of variation. One form is the variation of the response from its average value. This variation is summarized by the sample variance, the sum of the squared lengths of the <em>red</em> arrows divided by the number of observations minus 1. The other form of variation is the variation of the response from the fitted regression line. This variation is summarized by the sample variation of the residuals, the sum of squared lengths of the <em>black</em> arrows divided by the number of observations minus 1. The ratio between these two quantities gives the relative variability of the response that remains after fitting the regression line to the data.
      </p>
      <p>
        The line of the average is a straight line. The deviations of the observations from this straight line can be thought of as residuals from that line. The variability of these residuals, the sum of squares of the deviations from the average divided by the number of observations minus 1, is equal to the sample variance.
      </p>
      <p>
        The regression line is the unique straight line that minimizes the variability of its residuals. Consequently, the variability of the residuals from the regression, the sum of squares of the residuals from the regression divided by the number of observations minus 1, is the smallest residual variability produced by any straight line. It follows that the sample variance of the regression residuals is less than the sample variance of the response. Therefore, the ratio between the variance of the residuals and the variance of the response is less than 1.
      </p>
      <p>
        R-squared is the difference between 1 and the ratio of the variances. Its value is between 0 and 1 and it represents the fraction of the variability of the response that is <em>explained</em> by the regression line. The closer the points are to the regression line the larger the value of R-squared becomes. On the other hand, the less there is a linear trend in the data the closer to 0 is the value of R-squared. In the extreme case of R-squared equal to 1 all the data point are positioned exactly on a single straight line. In the other extreme, a value of 0 for R-squared implies no linear trend in the data.
      </p>
      <p>
        Let us compute manually the difference between 1 and the ratio between the variance of the residuals and the variance of the response:
      </p>

      <program language="r">
        <input>
1-var(residuals(fit))/var(y)
        </input>
      </program>

      <pre>
## [1] 0.3297413
      </pre>

      <p>
        Observe that the computed value of R-squared is the same as the value <q>Multiple R-squared: 0.3297</q> that is given in the report.
      </p>
      <p>
        The report provides another value of R-squared, titled <em>Adjusted R-squared</em>. The difference between the adjusted and unadjusted quantities is that in the former the sample variance of the residuals from the regression is replaced by an unbiased estimate of the variability of the response about the regression line. The sum of squares in the unbiased estimator is divided by the number of observations minus 2. Indeed, when we re-compute the ratio using the unbiased estimate, the sum of squared residuals divided by <m>10 - 2 = 8</m>, we get:
      </p>

      <program language="r">
        <input>
1-(sum(residuals(fit)^2)/8)/var(y)
        </input>
      </program>

      <pre>
## [1] 0.245959
      </pre>

      <p>
        The value of this adjusted quantity is equal to the value <q>Adjusted R-squared: 0.246</q> in the report.
      </p>
      <p>
        Which value of R-squared to use is a matter of personal taste. In any case, for a larger number of observations the difference between the two values becomes negligible.
      </p>
      <p>
        The last line in the report produces an overall goodness of fit test for the regression model. In the current application of linear regression this test reduces to a test of the slope being equal to zero, the same test that is reported in the second row of the table of coefficients<fn>In more complex applications of linear regression, applications that are not considered in this book, the test in the last line of the report and the tests of coefficients do not coincide.</fn>. The <m>F</m> statistic is simply the square of the <m>t</m> value that is given in the second row of the table. The sampling distribution of this statistic under the null hypothesis is the <m>F</m>-distribution on 1 and <m>n-2</m> degrees of freedom, which is the sampling distribution of the square of the test statistic for the slope. The computed <m>p</m>-value, <q>p-value: 0.08255</q> is the identical (after rounding up) to the <m>p</m>-value given in the second line of the table.
      </p>
      <p>
        Return to the R-squared coefficient. This coefficient is a convenient measure of the goodness of fit of the regression model to the data. Let us demonstrate this point with the aid of the <q><c>cars</c></q> data. In <xref ref="sec-regression-inference" /> we fitted a regression model to the power of the engine as a response and the size of the engine as an explanatory variable. The fitted model was saved in the object called <q><c>fit.power</c></q>. A report of this fit, the output of the expression <c>summary(fit.power)</c> was also presented. The null hypothesis of zero slope was clearly rejected. The value of R-squared for this fit was 0.6574. Consequently, about 2/3 of the variability in the power of the engine is explained by the size of the engine.
      </p>
      <p>
        Consider trying to fit a different regression model for the power of the engine as a response. The variable <q><c>length</c></q> describes the length of the car (in inches). How well would the length explain the power of the car? We may examine this question using linear regression:
      </p>

      <program language="r">
        <input>
summary(lm(horsepower ~ length, data=cars))
        </input>
      </program>

      <pre>
## 
## Call:
## lm(formula = horsepower ~ length, data = cars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -53.57 -20.35  -6.69  14.45 180.72 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -205.3971    32.8185  -6.259  2.3e-09 ***
## length         1.7796     0.1881   9.459  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 33.12 on 201 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.308,  Adjusted R-squared:  0.3046 
## F-statistic: 89.47 on 1 and 201 DF,  p-value: &lt; 2.2e-16
      </pre>

      <p>
        We used one expression to fit the regression model to the data and to summarize the outcome of the fit.
      </p>
      <p>
        A scatter plot of the two variables together with the regression line may be produced using the code:
      </p>

      <program language="r">
        <input>
plot(horsepower ~ length, data=cars)
abline(lm(horsepower ~ length, data=cars))
        </input>
      </program>
      <figure xml:id="fig-regression6a">
        <image source="_figures/Regression6a.png" width="60%">
        </image>
      </figure>
      <p>
        From the examination of the figure we may see that indeed there is a linear trend in the relation between the length and the power of the car. Longer cars tend to have more power. Testing the null hypothesis that the slope is equal to zero produces a very small <m>p</m>-value and leads to the rejection of the null hypothesis.
      </p>
      <p>
        The length of the car and the size of the engine are both statistically significant in their relation to the response. However, which of the two explanatory variables produces a better fit?
      </p>
      <p>
        An answer to this question may be provided by the examination of values of R-squared, the ratio of the variance of the response explained by each of the explanatory variable. The R-squared for the size of the engine as an explanatory variable is 0.6574, which is approximately equal to 2/3. The value of R-squared for the length of the car as an explanatory variable is 0.2933, less than 1/3. It follows that the size of the engine explains twice as much of the variability of the power of the engine than the size of car and is a better explanatory variable.
      </p>
  </section>

  <section xml:id="sec-exercises-14">
    <title>Exercises</title>
    
    <exercise>
      <statement>
        <p>
          <xref ref="fig-regression8" /> presents 10 points and three lines. One of the lines is colored <em>red</em> and one of the points is marked as a <em>red triangle</em>. The points in the plot refer to the data frame in <xref ref="table-regression2" /> and the three lines refer to the linear equations:
        </p>
        <p>
          1. <m>y = 4</m>
        </p>
        <p>
          2. <m>y = 5 - 2x</m>
        </p>
        <p>
          3. <m>y = x</m>
        </p>
        <p>
          You are asked to match the marked line to the appropriate linear equation and match the marked point to the appropriate observation:
        </p>
        <p>
          1. Which of the three equations, 1, 2 or 3, describes the line marked in <em>red</em>?
        </p>
        <p>
          2. The point marked with a <em>red triangle</em> represents which of the observations. (Identify the observation number.)
        </p>
        <table xml:id="table-regression2">
          <title>Points</title>
          <tabular>
            <row header="yes">
              <cell>Observation</cell>
              <cell><m>x</m></cell>
              <cell><m>y</m></cell>
            </row>
            <row>
              <cell>1</cell>
              <cell>2.3</cell>
              <cell>-3.0</cell>
            </row>
            <row>
              <cell>2</cell>
              <cell>-1.9</cell>
              <cell>9.8</cell>
            </row>
            <row>
              <cell>3</cell>
              <cell>1.6</cell>
              <cell>4.3</cell>
            </row>
            <row>
              <cell>4</cell>
              <cell>-1.6</cell>
              <cell>8.2</cell>
            </row>
            <row>
              <cell>5</cell>
              <cell>0.8</cell>
              <cell>5.9</cell>
            </row>
            <row>
              <cell>6</cell>
              <cell>-1.0</cell>
              <cell>4.3</cell>
            </row>
            <row>
              <cell>7</cell>
              <cell>-0.2</cell>
              <cell>2.0</cell>
            </row>
            <row>
              <cell>8</cell>
              <cell>2.4</cell>
              <cell>-4.7</cell>
            </row>
            <row>
              <cell>9</cell>
              <cell>1.8</cell>
              <cell>1.8</cell>
            </row>
            <row>
              <cell>10</cell>
              <cell>1.4</cell>
              <cell>-1.1</cell>
            </row>
          </tabular>
        </table>
      </statement>
    </exercise>
    
    <figure xml:id="fig-regression8">
      <caption>Lines and Points</caption>
      <image source="_figures/Regression8.png" width="60%">
        <description>Scatter plot with 10 points and three lines, one marked in red</description>
      </image>
    </figure>
    
    <exercise>
      <statement>
        <p>
          Assume a regression model that describes the relation between the expectation of the response and the value of the explanatory variable in the form:
        </p>
        <me>\Expec(Y_i) = 2.13 \cdot x_i - 3.60\;.</me>
        <p>
          1. What is the value of the intercept and what is the value of the slope in the linear equation that describes the model?
        </p>
        <p>
          2. Assume the <m>x_1 = 5.5</m>, <m>x_2 = 12.13</m>, <m>x_3 = 4.2</m>, and <m>x_4 = 6.7</m>. What is the expected value of the response of the 3rd observation?
        </p>
      </statement>
    </exercise>
    
    <exercise>
      <statement>
        <p>
          The file <q><c>aids.csv</c></q> contains data on the number of diagnosed cases of Aids and the number of deaths associated with Aids among adults and adolescents in the United States between 1981 and 2002<fn>The data is taken from <url href="http://cnx.org/content/m17088/latest/">Table 1</url> in section <q>Practice in Linear Regression</q> of the online Textbook <url href="http://cnx.org/content/col10522/1.38/"><q>Collaborative Statistics</q> (Connexions. March 22, 2010. http://cnx.org/content/col10522/1.38/)</url> by Barbara Illowsky and Susan Dean.</fn>. The file can be found on the internet at <url href="http://pluto.huji.ac.il/~msby/StatThink/Datasets/aids.csv">http://pluto.huji.ac.il/~msby/StatThink/Datasets/aids.csv</url>.
        </p>
        <p>
          The file contains 3 variables: The variable <q><c>year</c></q> that tells the relevant year, the variable <q><c>diagnosed</c></q> that reports the number of Aids cases that were diagnosed in each year, and the variable <q><c>deaths</c></q> that reports the number of Aids related deaths in each year. The following questions refer to the data in the file:
        </p>
        <p>
          1. Consider the variable <q><c>deaths</c></q> as response and the variable <q><c>diagnosed</c></q> as an explanatory variable. What is the slope of the regression line? Produce a point estimate and a confidence interval. Is it statistically significant (namely, significantly different than 0)?
        </p>
        <p>
          2. Plot the scatter plot that is produced by these two variables and add the regression line to the plot. Does the regression line provided a good description of the trend in the data?
        </p>
        <p>
          3. Consider the variable <q><c>diagnosed</c></q> as the response and the variable <q><c>year</c></q> as the explanatory variable. What is the slope of the regression line? Produce a point estimate and a confidence interval. Is the slope in this case statistically significant?
        </p>
        <p>
          4. Plot the scatter plot that is produced by the later pair of variables and add the regression line to the plot. Does the regression line provided a good description of the trend in the data?
        </p>
      </statement>
    </exercise>
    
    <exercise>
      <statement>
        <p>
          Below are the percents of the U.S. labor force (excluding self-employed and unemployed) that are members of a labor union<fn>Taken from <url href="http://cnx.org/content/m17085/latest/">Homework</url> section in the chapter on linear regression of the online Textbook <url href="http://cnx.org/content/col10522/1.38/"><q>Collaborative Statistics</q> (Connexions. March 22, 2010. http://cnx.org/content/col10522/1.38/)</url> by Barbara Illowsky and Susan Dean.</fn>. We use this data in order to practice the computation of the regression coefficients.
        </p>
        <table xml:id="table-regression4">
          <title>Percent of Union Members</title>
          <tabular>
            <row header="yes">
              <cell>year</cell>
              <cell>percent</cell>
            </row>
            <row>
              <cell>1945</cell>
              <cell>35.5</cell>
            </row>
            <row>
              <cell>1950</cell>
              <cell>31.5</cell>
            </row>
            <row>
              <cell>1960</cell>
              <cell>31.4</cell>
            </row>
            <row>
              <cell>1970</cell>
              <cell>27.3</cell>
            </row>
            <row>
              <cell>1980</cell>
              <cell>21.9</cell>
            </row>
            <row>
              <cell>1986</cell>
              <cell>17.5</cell>
            </row>
            <row>
              <cell>1993</cell>
              <cell>15.8</cell>
            </row>
          </tabular>
        </table>
        <p>
          1. Produce the scatter plot of the data and add the regression line. Is the regression model reasonable for this data?
        </p>
        <p>
          2. Compute the sample averages and the sample standard deviations of both variables. Compute the covariance between the two variables.
        </p>
        <p>
          3. Using the summaries you have just computed, recompute the coefficients of the regression model.
        </p>
      </statement>
    </exercise>
    
    <exercise>
      <statement>
        <p>
          Assume a regression model was fit to some data that describes the relation between the explanatory variable <m>x</m> and the response <m>y</m>. Assume that the coefficients of the fitted model are <m>a=2.5</m> and <m>b=-1.13</m>, for the intercept and the slope, respectively. The first 4 observations in the data are <m>(x_1,y_1) = (5.5,3.22)</m>, <m>(x_2,y_2) = (12.13,-6.02)</m>, <m>(x_3,y_3) = (4.2,-8.3)</m>, and <m>(x_4,y_4) = (6.7,0.17)</m>.
        </p>
        <p>
          1. What is the estimated expectation of the response for the 4th observation?
        </p>
        <p>
          2. What is the residual from the regression line for the 4th observation?
        </p>
      </statement>
    </exercise>
    
    <exercise>
      <statement>
        <p>
          In <xref ref="ch-two-samples" /> we analyzed an example that involved the difference between fuel consumption in highway and city driving conditions as the response<fn>The response was computed using the expression <q><c>cars$highway.mpg - cars$city.mpg</c></q></fn>. The explanatory variable was a factor that was produced by splitting the cars into two weight groups. In this exercise we would like to revisit this example. Here we use the weight of the car directly as an explanatory variable. We also consider the size of the engine as an alternative explanatory variable and compare between the two regression models.
        </p>
        <p>
          1. Fit the regression model that uses the variable <q><c>curb.weight</c></q> as an explanatory variable. Is the slope significantly different than 0? What fraction of the standard deviation of the response is explained by a regression model involving this variable?
        </p>
        <p>
          2. Fit the regression model that uses the variable <q><c>engine.size</c></q> as an explanatory variable. Is the slope significantly different than 0? What fraction of the standard deviation of the response is explained by a regression model involving this variable?
        </p>
        <p>
          3. Which of the two models fits the data better?
        </p>
      </statement>
    </exercise>
  </section>

  <section xml:id="sec-summary-14">
    <title>Summary</title>
    
    <subsection xml:id="subsec-glossary-14">
      <title>Glossary</title>
      <dl>
        <li>
          <title>Regression</title>
          <p>Relates different variables that are measured on the same sample. Regression models are used to describe the effect of one of the variables on the distribution of the other one. The former is called the explanatory variable and the later is called the response.</p>
        </li>
        <li>
          <title>Linear Regression</title>
          <p>The effect of a numeric explanatory variable on the distribution of a numeric response is described in terms of a linear trend.</p>
        </li>
        <li>
          <title>Scatter Plot</title>
          <p>A plot that presents the data in a pair of numeric variables. The axes represents the variables and each point represents an observation.</p>
        </li>
        <li>
          <title>Intercept</title>
          <p>A coefficient of a linear equation. Equals the value of <m>y</m> when the line crosses the <m>y</m>-axis.</p>
        </li>
        <li>
          <title>Slope</title>
          <p>A coefficient of a linear equation. The change in the value of <m>y</m> for each unit change in the value of <m>x</m>. A positive slope corresponds to an increasing line and a negative slope corresponds to a decreasing line.</p>
        </li>
        <li>
          <title>Covariance</title>
          <p>A measures the joint variability of two numeric variables. It is equal to the sum of the product of the deviations from the mean, divided by the number of observations minus 1.</p>
        </li>
        <li>
          <title>Residuals from Regression</title>
          <p>The residual differences between the values of the response for the observation and the estimated expectations of the response under the regression model (the predicted response).</p>
        </li>
        <li>
          <title>R-Square</title>
          <p>is the difference between 1 and the ratio between the variance of the residuals from the regression and the variance of the response. Its value is between 0 and 1 and it represents the fraction of the variability of the response that is <term>explained</term> by the regression line.</p>
        </li>
      </dl>
    </subsection>
    
    <subsection xml:id="subsec-formulas-14">
      <title>Formulas</title>
      <dl>
        <li>
          <title>A Linear Equation</title>
          <p><m>y = a + b \cdot x</m>.</p>
        </li>
        <li>
          <title>Covariance</title>
          <p><m>\frac{\mbox{Sum of products of the deviations}}{\mbox{Number of values in the sample}-1} = \frac{\sum_{i=1}^n (y_i-\bar y)(x_i - \bar x)}{n-1}</m>.</p>
        </li>
        <li>
          <title>Regression Slope</title>
          <p><m>b = \mbox{Covariance}(x,y)/\mbox{Var}(x)</m>.</p>
        </li>
        <li>
          <title>Regression Intercept</title>
          <p><m>a = \bar y - b\bar x</m>.</p>
        </li>
        <li>
          <title>The Regression Model</title>
          <p><m>\Expec(Y_i) = a + b \cdot x_i</m>, <m>a</m> and <m>b</m> population parameters.</p>
        </li>
        <li>
          <title>Residuals</title>
          <p><m>y_i - (a + bx_i)</m>, <m>a</m> and <m>b</m> estimated from the data.</p>
        </li>
        <li>
          <title>Estimate of Residual Variance</title>
          <p><m>\sum_{i=1}^n(y_i - (a + bx_i))^2/(n-2)</m>, <m>a</m> and <m>b</m> estimated from the data.</p>
        </li>
        <li>
          <title>R-Squared</title>
          <p><m>1 - \sum_{i=1}^n(y_i - (a + bx_i))^2/\sum_{i=1}^n(y_i - \bar y)^2</m>, <m>a</m> and <m>b</m> estimated from the data.</p>
        </li>
      </dl>
    </subsection>
  </section>
</chapter>
