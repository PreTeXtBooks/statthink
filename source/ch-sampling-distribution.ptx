<?xml version="1.0" encoding="UTF-8" ?>

<chapter xml:id="ch-sampling-distribution" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>The Sampling Distribution</title>

  <section xml:id="sec-student-learning-objectives-7">
    <title>Student Learning Objectives</title>
    <p>
      In this section we integrate the concept of <em>data</em> that is extracted from a sample with the concept of a <em>random variable</em>. The new element that connects between these two concepts is the notion of <em>sampling distribution</em>. The data we observe results from the specific sample that was selected. The sampling distribution, in a similar way to random variables, corresponds to all samples that could have been selected. (Or, stated in a different tense, to the sample that will be selected prior to the selection itself.) Summaries of the distribution of the data, such as the sample mean and the sample standard deviation, become random variables when considered in the context of the sampling distribution. In this section we investigate the sampling distribution of such data summaries. In particular, it is demonstrated that (for large samples) the sampling distribution of the sample average may be approximated by the Normal distribution. The mathematical theorem that proves this approximation is called the <em>Central Limit Theory</em>. By the end of this chapter, the student should be able to:
    </p>
    <ul>
      <li><p>Comprehend the notion of sampling distribution and simulate the sampling distribution of the sample average.</p></li>
      <li><p>Relate the expectation and standard deviation of a measurement to the expectation and standard deviation of the sample average.</p></li>
      <li><p>Apply the Central Limit Theorem to the sample averages.</p></li>
    </ul>
  </section>

  <section xml:id="sec-sampling-distribution">
    <title>The Sampling Distribution</title>
    <p>
      In <xref ref="ch-random-variables" /> the concept of a random variable was introduced. As part of the introduction we used an example that involved the selection of a random person from the population and the measuring of his/her height. Prior to the action of selection, the height of that person is a <em>random variable</em>. It has the potential of obtaining any of the heights that are present in the population, which is the <em>sample space</em> of this example, with a distribution that reflects the relative frequencies of each of the heights in the population: the <em>probabilities</em> of the values. After the selection of the person and the measuring of the height we get a particular value. This is the <em>observed value</em> and is no longer a random variable. In this section we extend the concept of a random variable and define the concept of <em>a random sample</em>.
    </p>

    <subsection xml:id="subsec-random-sample">
      <title>A Random Sample</title>
      <p>
        The relation between the random sample and the data is similar to the relation between a random variable and the observed value. The data is the observed values of a sample taken from a population. The content of the data is known. The random sample, similarly to a random variable, is the data that <em>will</em> be selected when taking a sample, prior to the selection itself. The content of the random sample is unknown, since the sample has not yet been taken. Still, just like for the case of the random variable, one is able to say what the possible evaluations of the sample may be and, depending on the mechanism of selecting the sample, what are the probabilities of the different potential evaluations. The collection of all possible evaluations of the sample is the <em>sample space of the random sample</em> and the probabilities of the different evaluations produce the <em>distribution</em> of the random sample.
      </p>
      <p>
        (Alternatively, if one prefers to speak in past tense, one can define the sample space of a random sample to be the evaluations of the sample that could have taken place, with the distribution of the random sample being the probabilities of these evaluations.)
      </p>
      <p>
        A <em>statistic</em> is a function of the data. Example of statistics are the average of the data, the sample variance and standard deviation, the median of the data, etc. In each case a given formula is applied to the data. In each type of statistic a different formula is applied.
      </p>
      <p>
        The same formula that is applied to the observed data may, in principle, be applied to random samples. Hence, for example, one may talk of the sample average, which is the average of the elements in the data. The average, considered in the context of the observed data, is a number and its value is known. However, if we think of the average in the context of a random sample then it becomes a random variable. Prior to the selection of the actual sample we do not know what values it will include. Hence, we cannot tell what the outcome of the average of the values will be. However, due to the identification of all possible evaluations that the sample can possess we may say in advance what is the collection of values the sample average can have. This is the sample space of the sample average. Moreover, from the sampling distribution of the random sample one may identify the probability of each value of the sample average, thus obtaining the <em>sampling distribution</em> of the sample average.
      </p>
      <p>
        The same line of argumentation applies to any statistic. Computed in the context of the observed data, the statistic is a known number that may, for example, be used to characterize the variation in the data. When thinking of a statistic in the context of a random sample it becomes a random variable. The distribution of the statistic is called the sampling distribution of the statistic. Consequently, we may talk of the sampling distribution of the median, the sample distribution of the sample variance, etc.
      </p>
      <p>
        Random variables are also applied as models for uncertainty in future measurements in more abstract settings that need not involve a specific population. Specifically, we introduced the Binomial and Poisson random variables for settings that involve counting and the Uniform, Exponential, and Normal random variables for settings where the measurement is continuous.
      </p>
      <p>
        The notion of a sampling distribution may be extended to a situation where one is taking several measurements, each measurement taken independently of the others. As a result one obtains a <em>sequence</em> of measurements. We use the term <q>sample</q> to denote this sequence. The distribution of this sequence is also called the sampling distribution. If all the measurements in the sequence are Binomial then we call it a <em>Binomial sample</em>. If all the measurements are Exponential we call it an <em>Exponential sample</em> and so forth.
      </p>
      <p>
        Again, one may apply a formula (such as the average) to the content of the random sequence and produce a random variable. The term <em>sampling distribution</em> describes again the distribution that the random variable produced by the formula inherits from the sample.
      </p>
      <p>
        In the next subsection we examine an example of a sample taken from a population. Subsequently, we discuss examples that involves a sequence of measurements from a theoretical model.
      </p>
    </subsection>

    <subsection xml:id="subsec-sampling-population">
      <title>Sampling From a Population</title>
      <p>
        Consider taking a sample from a population. Let us use again for the illustration the file <q><c>pop1.csv</c></q> like we did in <xref ref="ch-probability" />. The data frame produced from the file contains the sex and height of the 100,000 members of some imaginary population. Recall that in <xref ref="ch-probability" /> we applied the function <q><c>sample</c></q> to randomly sample the height of a single subject from the population. Let us apply the same function again, but this time in order to sample the heights of 100 subjects:
      </p>
      <program language="r">
        <input>
pop.1 &lt;- read.csv("_data/pop1.csv")
X.samp &lt;- sample(pop.1$height,100)
X.samp
        </input>
      </program>
      <p>
        In the first line of code we produce a data frame that contains the information on the entire population. In the second line we select a sample of size 100 from the population, and in the third line we present the content of the sample.
      </p>
      <p>
        The first argument to the function <q><c>sample</c></q> that selects the sample is the sequence of length 100,000 with the list of heights of all the members of the population. The second argument indicates the sample size, 100 in this case. The outcome of the random selection is stored in the object <q><c>X.samp</c></q>, which is a sequence that contains 100 heights.
      </p>
      <p>
        Typically, a researcher does not get to examine the entire population. Instead, measurements on a sample from the population are made. In relation to the imaginary setting we simulate in the example, the typical situation is that the research does not have the complete list of potential measurement evaluations, i.e. the complete list of 100,000 heights in <q><c>pop.1$height</c></q>, but only a sample of measurements, namely the list of 100 numbers that are stored in <q><c>X.samp</c></q> and are presented above. The role of statistics is to make inference on the parameters of the unobserved population based on the information that is obtained from the sample.
      </p>
      <p>
        For example, we may be interested in estimating the mean value of the heights in the population. A reasonable proposal is to use the sample average to serve as an estimate:
      </p>
      <program language="r">
        <input>
mean(X.samp)
        </input>
      </program>
      <p>
        In our artificial example we can actually compute the true population mean:
      </p>
      <program language="r">
        <input>
mean(pop.1$height)
        </input>
      </program>
      <p>
        Hence, we may see that although the match between the estimated value and the actual value is not perfect still they are close enough.
      </p>
      <p>
        The actual estimate that we have obtained resulted from the specific sample that was collected. Had we collected a different subset of 100 individuals we would have obtained different numerical value for the estimate. Consequently, one may wonder: Was it pure luck that we got such good estimates? How likely is it to get estimates that are close to the target parameter?
      </p>
      <p>
        Notice that in realistic settings we do not know the actual value of the target population parameters. Nonetheless, we would still want to have at least a probabilistic assessment of the distance between our estimates and the parameters they try to estimate. The sampling distribution is the vehicle that may enable us to address these questions.
      </p>
      <p>
        In order to illustrate the concept of the sampling distribution let us select another sample and compute its average:
      </p>
      <program language="r">
        <input>
X.samp &lt;- sample(pop.1$height,100)
X.bar &lt;- mean(X.samp)
X.bar
        </input>
      </program>
      <p>
        and do it once more:
      </p>
      <program language="r">
        <input>
X.samp &lt;- sample(pop.1$height,100)
X.bar &lt;- mean(X.samp)
X.bar
        </input>
      </program>
      <p>
        In each case we got a different value for the sample average. In the first of the last two iterations the result was more than 1 centimeter away from the population average, which is equal to 170.035, and in the second it was within the range of 1 centimeter. Can we say, prior to taking the sample, what is the probability of falling within 1 centimeter of the population mean?
      </p>
      <p>
        <xref ref="ch-probability" /> discussed the random variable that emerges by randomly sampling a single number from the population presented by the sequence <q><c>pop.1$height</c></q>. The distribution of the random variable resulted from the assignment of the probability 1/100,000 to each one of the 100,000 possible outcomes. The same principle applies when we randomly sample 100 individuals. Each possible outcome is a collection of 100 numbers and each collection is assigned equal probability. The resulting distribution is called <em>the sampling distribution</em>.
      </p>
      <p>
        The distribution of the average of the sample emerges from this distribution: With each sample one may associate the average of that sample. The probability assigned to that average outcome is the probability of the sample. Hence, one may assess the probability of falling within 1 centimeter of the population mean using the sampling distribution. Each sample produces an average that either falls within the given range or not. The probability of the sample average falling within the given range is the proportion of samples for which this event happens among the entire collection of samples.
      </p>
      <p>
        However, we face a technical difficulty when we attempt to assess the sampling distribution of the average and the probability of falling within 1 centimeter of the population mean. Examination of the distribution of a sample of a single individual is easy enough. The total number of outcomes, which is 100,000 in the given example, can be handled with no effort by the computer. However, when we consider samples of size 100 we get that the total number of ways to select 100 number out of 100,000 numbers is in the order of <m>10^{342}</m> (1 followed by 342 zeros) and cannot be handled by any computer. Thus, the probability cannot be computed.
      </p>
      <p>
        As a compromise we will approximate the distribution by selecting a large number of samples, say 100,000, to represent the entire collection, and use the resulting distribution as an approximation of the sampling distribution. Indeed, the larger the number of samples that we create the more accurate the approximation of the distribution is. Still, taking 100,000 repeats should produce approximations which are good enough for our purposes.
      </p>
      <p>
        Consider the sampling distribution of the sample average. We simulated above a few examples of the average. Now we would like to simulate 100,000 such examples. We do this by creating first a sequence of the length of the number of evaluations we seek (100,000) and then write a small program that produces each time a new random sample of size 100 and assigns the value of the average of that sample to the appropriate position in the sequence. Do first and explain later<fn>Running this simulation, and similar simulations of the same nature that will be considered in the sequel, demands more of the computer's resources than the examples that were considered up until now. Beware that running times may be long and, depending on the strength of your computer and your patience, too long. You may save time by running less iterations, replacing, say, <q><c>10^5</c></q> by <q><c>10^4</c></q>. The results of the simulation will be less accurate, but will still be meaningful.</fn>:
      </p>
      <program language="r">
        <input>
X.bar &lt;- rep(0,10^5)
for(i in 1:10^5) {
  X.samp &lt;- sample(pop.1$height,100)
  X.bar[i] &lt;- mean(X.samp)
}
        </input>
      </program>
      <p>
        In the first line we produce a sequence of length 100,000 that contains zeros. The function <q><c>rep</c></q> creates a sequence that contains repeats of its first argument a number of times that is specified by its second argument. In this example, the numerical value 0 is repeated 100,000 times to produce a sequence of zeros of the length we seek.
      </p>
      <p>
        The main part of the program is a <q><c>for</c></q> loop. The argument of the function <q><c>for</c></q> takes the special form: <q><em>index.name</em> <c>in</c> <em>index.values</em></q>, where <em>index.name</em> is the name of the running index and <em>index.values</em> is the collection of values over which the running index is evaluated. In each iteration of the loop the running index is assigned a value from the collection and the expression that follows the brackets of the <q><c>for</c></q> function is evaluated with the given value of the running index.
      </p>
      <p>
        In the given example the collection of values is produced by the expression <q><c>1:n</c></q>. Recall that the expression <q><c>1:n</c></q> produces the collection of integers between <c>1</c> and <c>n</c>. Here, <c>n</c> = 100,000. Hence, in the given application the collection of values is a sequence that contains the integers between 1 and 100,000. The running index is called <q><c>i</c></q>. the expression is evaluated 100,000 times, each time with a different integer value for the running index <q><c>i</c></q>.
      </p>
      <p>
        The <c>R</c> system treats a collection of expressions enclosed within curly brackets as one entity. Therefore, in each iteration of the <q><c>for</c></q> loop, the lines that are within the curly brackets are evaluated. In the first line a random sample of size 100 is produced and in the second line the average of the sample is computed and stored in the <m>i</m>-th position of the sequence <q><c>X.bar</c></q>. Observe that the specific position in the sequence is referred to by using square brackets.
      </p>
      <p>
        The program changes the original components of the sequence, from 0 to the average of a random sample, one by one. When the loop ends all values are changed and the sequence <q><c>X.bar</c></q> contains 100,000 evaluations of the sample average. The last line, which is outside the curly brackets and is evaluated after the <q><c>for</c></q> loop ends, produces an histogram of the averages that were simulated. The histogram is presented in the lower panel of <xref ref="fig-sampdist6" />.
      </p>
      <figure xml:id="fig-sampdist6">
        <caption>Distribution of Height and the Sampling Distribution of Averages</caption>
        <image source="_figures/SampDist6.png" width="60%">
          <description>Two panel figure showing population height distribution on top and sampling distribution of averages on bottom</description>
        </image>
      </figure>
      <p>
        Compare the distribution of the sample average to the distribution of the heights in the population that was presented first in <xref ref="fig-prob1" /> and is currently presented in the upper panel of <xref ref="fig-sampdist6" />. Observe that both distributions are centered at about 170 centimeters. Notice, however, that the range of values of the sample average lies essentially between 166 and 174 centimeters, whereas the range of the distribution of heights themselves is between 127 and 217 centimeter. Broadly speaking, the sample average and the original measurement are centered around the same location but the sample average is less spread.
      </p>
      <p>
        Specifically, let us compare the expectation and standard deviation of the sample average to the expectation and standard deviation of the original measurement:
      </p>
      <program language="r">
        <input>
mean(pop.1$height)
sd(pop.1$height)
mean(X.bar)
sd(X.bar)
        </input>
      </program>
      <p>
        Observe that the expectation of the population and the expectation of the sample average are practically the same, but the standard deviation of the sample average is about 10 times smaller than the standard deviation of the population. This result is not accidental and actually reflects a general phenomena that will be seen below in other examples.
      </p>
      <p>
        We may use the simulated sampling distribution in order to compute an approximation of the probability of the sample average falling within 1 centimeter of the population mean. Let us first compute the relevant probability and then explain the details of the computation:
      </p>
      <program language="r">
        <input>
mean(abs(X.bar - mean(pop.1$height)) &lt;= 1)
        </input>
      </program>
      <p>
        Hence we get that the probability of the given event is about 62.6%.
      </p>
      <p>
        The object <q><c>X.bar</c></q> is a sequence of length 100,000 that contains the simulated sample averages. This sequence represents the distribution of the sample average. The expression <q><c>abs(X.bar - mean(pop.1$height)) &lt;= 1</c></q> produces a sequence of logical <q><c>TRUE</c></q> or <q><c>FALSE</c></q> values, depending on the value of the sample average being less or more than one unit away from the population mean. The application of the function <q><c>mean</c></q> to the output of the last expression results in the computation of the relative frequency of <c>TRUE</c>s, which corresponds to the probability of the event of interest.
      </p>
      <example xml:id="ex-sampdist1">
        <p>
          A poll for the determination of the support in the population for a candidate was describe in Example 5.1. The proportion in the population of supporters was denoted by <m>p</m>. A sample of size <m>n=300</m> was considered in order to estimate the size of <m>p</m>. We identified that the distribution of <m>X</m>, the number of supporters in the sample, is <m>\mathrm{Binomial}(300,p)</m>. This distribution is the sampling distribution<fn>Mathematically speaking, the Binomial distribution is only an approximation to the sampling distribution of <m>X</m>. Actually, the Binomial is an exact description to the distribution only in the case where each subject has the chance be represented in the sample more than once. However, only when the size of the sample is comparable to the size of the population would the Binomial distribution fail to be an adequate approximation to the sampling distribution.</fn> of <m>X</m>. One may use the proportion in the sample of supporters, the number of supporters in the sample divided by 300, as an estimate to the parameter <m>p</m>. The sampling distribution of this quantity, <m>X/300</m>, may be considered in order to assess the discrepancy between the estimate and the actual value of the parameter.
        </p>
      </example>
    </subsection>

    <subsection xml:id="subsec-theoretical-models">
      <title>Theoretical Models</title>
      <p>
        Sampling distribution can also be considered in the context of theoretical distribution models. For example, take a measurement <m>X \sim \mathrm{Binomial}(10,0.5)</m> from the Binomial distribution. Assume 64 independent measurements are produced with this distribution: <m>X_1, X_2, \ldots, X_{64}</m>. The sample average in this case corresponds to the distribution of the random variable produced by averaging these 64 random variables:
      </p>
      <me>\bar X = \frac{X_1 + X_2 + \cdots + X_{64}} {64} = \frac{1}{64}\sum_{i=1}^{64} X_i\;.</me>
      <p>
        Again, one may wonder what is the distribution of the sample average <m>\bar X</m> in this case?
      </p>
      <p>
        We can approximate the distribution of the sample average by simulation. The function <q><c>rbinom</c></q> produces a random sample from the Binomial distribution. The first argument to the function is the sample size, which we take in this example to be equal to 64. The second and third arguments are the parameters of the Binomial distribution, 10 and 0.5 in this case. We can use this function in the simulation:
      </p>
      <program language="r">
        <input>
X.bar &lt;- rep(0,10^5)
for(i in 1:10^5) {
  X.samp &lt;- rbinom(64,10,0.5)
  X.bar[i] &lt;- mean(X.samp)
}
        </input>
      </program>
      <p>
        Observe that in this code we created a sequence of length 100,000 with evaluations of the sample average of 64 Binomial random variables. We start with a sequence of zeros and in each iteration of the <q><c>for</c></q> loop a zero is replaced by the average of a random sample of 64 Binomial random variables.
      </p>
      <figure xml:id="fig-sampdist7">
        <caption>Distributions of an Average and a Single Binomial(10,0.5)</caption>
        <image source="_figures/SampDist7.png" width="60%">
          <description>Two panel figure comparing single Binomial distribution and average of 64 Binomials</description>
        </image>
      </figure>
      <p>
        Examine the sampling distribution of the Binomial average:
      </p>
      <program language="r">
        <input>
mean(X.bar)
sd(X.bar)
        </input>
      </program>
      <p>
        The histogram of the sample average is presented in the lower panel of <xref ref="fig-sampdist7" />. Compare it to the distribution of a single Binomial random variable that appears in the upper panel. Notice, once more, that the center of the two distributions coincide but the spread of the sample average is smaller. The sample space of a single Binomial random variable is composed of integers. The sample space of the average of 64 Binomial random variables, on the other hand, contains many more values and is closer to the sample space of a random variable with a continuous distribution.
      </p>
      <p>
        Recall that the expectation of a <m>\mathrm{Binomial}(10,0.5)</m> random variable is <m>\Expec(X) = 10 \cdot 0.5 = 5</m> and the variance is <m>\Var(X) = 10 \cdot 0.5 \cdot 0.5 = 2.5</m> (thus, the standard deviation is <m>\sqrt{2.5} = 1.581139</m>). Observe that the expectation of the sample average that we got from the simulation is essentially equal to 5 and the standard deviation is 0.1982219.
      </p>
      <p>
        One may prove mathematically that the expectation of the sample mean is equal to the theoretical expectation of its components:
      </p>
      <me>\Expec(\bar X) = \Expec(X)\;.</me>
      <p>
        The results of the simulation for the expectation of the sample average are consistent with the mathematical statement. The mathematical theory of probability may also be used in order to prove that the variance of the sample average is equal to the variance of each of the components, divided by the sample size:
      </p>
      <me>\Var(\bar X) = \Var(X)/n\;,</me>
      <p>
        here <m>n</m> is the number of observations in the sample. Specifically, in the Binomial example we get that <m>\Var(\bar X) = 2.5/64</m>, since the variance of a Binomial component is 2.5 and there are 64 observations. Consequently, the standard deviation is <m>\sqrt{2.5/64} = 0.1976424</m>, in agreement, more or less, with the results of the simulation (that produced 0.1982219 as the standard deviation).
      </p>
      <p>
        Consider the problem of identifying the central interval that contains 95% of the distribution. In the Normal distribution we were able to use the function <q><c>qnorm</c></q> in order to compute the percentiles of the theoretical distribution. A function that can be used for the same purpose for simulated distribution is the function <q><c>quantile</c></q>. The first argument to this function is the sequence of simulated values of the statistic, <q><c>X.bar</c></q> in the current case. The second argument is a number between 0 and 1, or a sequence of such numbers:
      </p>
      <program language="r">
        <input>
quantile(X.bar,c(0.025,0.975))
        </input>
      </program>
      <p>
        We used the sequence <q><c>c(0.025,0.975)</c></q> as the input to the second argument. As a result we obtained the output 4.609375, which is the 2.5%-percentile of the sampling distribution of the average, and 5.390625, which is the 97.5%-percentile of the sampling distribution of the average.
      </p>
      <p>
        Of interest is to compare these percentiles to the parallel percentiles of the Normal distribution with the same expectation and the same standard deviation as the average of the Binomials:
      </p>
      <program language="r">
        <input>
qnorm(c(0.025,0.975),mean(X.bar),sd(X.bar))
        </input>
      </program>
      <p>
        Observe the similarity between the percentiles of the distribution of the average and the percentiles of the Normal distribution. This similarity is a reflection of the Normal approximation of the sampling distribution of the average, which is formulated in the next section under the title: <em>The Central Limit Theorem</em>.
      </p>
      <example xml:id="ex-sampdist3">
        <p>
          The distribution of the number of events of radio active decay in a second was modeled in Example 5.3 according to the Poisson distribution. A quantity of interest is <m>\lambda</m>, the expectation of that Poisson distribution. This quantity may be estimated by measuring the total number of decays over a period of time and dividing the outcome by the number of seconds in that period of time. Let <m>n</m> be this number of second. The procedure just described corresponds to taking the sample average of <m>\mathrm{Poisson}(\lambda)</m> observations for a sample of size <m>n</m>. The expectation of the sample average is <m>\lambda</m> and the variance is <m>\lambda/n</m>, leading to a standard deviation of size <m>\sqrt{\lambda/n}</m>. The Central Limit Theorem states that the sampling distribution of this average corresponds, approximately, to the Normal distribution with this expectation and standard deviation.
        </p>
      </example>
    </subsection>
  </section>

  <section xml:id="sec-law-large-numbers-clt">
    <title>Law of Large Numbers and Central Limit Theorem</title>
    <p>
      The Law of Large Numbers and the Central Limit Theorem are mathematical theorems that describe the sampling distribution of the average for large samples.
    </p>

    <subsection xml:id="subsec-law-large-numbers">
      <title>The Law of Large Numbers</title>
      <p>
        The Law of Large Numbers states that, as the sample size becomes larger, the sampling distribution of the sample average becomes more and more concentrated about the expectation.
      </p>
      <p>
        Let us demonstrate the Law of Large Numbers in the context of the Uniform distribution. Let the distribution of the measurement <m>X</m> be <m>\mathrm{Uniform}(3,7)</m>. Consider three different sample sizes <m>n</m>: <m>n=10</m>, <m>n=100</m>, and <m>n=1000</m>. Let us carry out a simulation similar to the simulations of the previous section. However, this time we run the simulation for the three sample sizes in parallel:
      </p>
      <program language="r">
        <input>
unif.10 &lt;- rep(0,10^5)
unif.100 &lt;- rep(0,10^5)
unif.1000 &lt;- rep(0,10^5)
for(i in 1:10^5) {
  X.samp.10 &lt;- runif(10,3,7)
  unif.10[i] &lt;- mean(X.samp.10)
  X.samp.100 &lt;- runif(100,3,7)
  unif.100[i] &lt;- mean(X.samp.100)
  X.samp.1000 &lt;- runif(1000,3,7)
  unif.1000[i] &lt;- mean(X.samp.1000)
}
        </input>
      </program>
      <p>
        Observe that we have produced 3 sequences of length 100,000 each: <q><c>unif.10</c></q>, <q><c>unif.100</c></q>, and <q><c>unif.1000</c></q>. The first sequence is an approximation of the sampling distribution of an average of 10 independent Uniform measurements, the second approximates the sampling distribution of an average of 100 measurements and the third the distribution of an average of 1000 measurements. The distribution of single measurement in each of the examples is <m>\mathrm{Uniform}(3,7)</m>.
      </p>
      <p>
        Consider the expectation of sample average for the three sample sizes:
      </p>
      <program language="r">
        <input>
mean(unif.10)
mean(unif.100)
mean(unif.1000)
        </input>
      </program>
      <p>
        For all sample size the expectation of the sample average is equal to 5, which is the expectation of the <m>\mathrm{Uniform}(3,7)</m> distribution.
      </p>
      <p>
        Recall that the variance of the <m>\mathrm{Uniform}(a,b)</m> distribution is <m>(b-a)^2/12</m>. Hence, the variance of the given Uniform distribution is <m>\Var(X) = (7-3)^2/12 = 16/12 \approx 1.3333</m>. The variances of the sample averages are:
      </p>
      <program language="r">
        <input>
var(unif.10)
var(unif.100)
var(unif.1000)
        </input>
      </program>
      <p>
        Notice that the variances decrease with the increase of the sample sizes. The decrease is according to the formula <m>\Var(\bar X) = \Var(X)/n</m>.
      </p>
      <p>
        The variance is a measure of the spread of the distribution about the expectation. The smaller the variance the more concentrated is the distribution around the expectation. Consequently, in agreement with the Law of Large Numbers, the larger the sample size the more concentrated is the sampling distribution of the sample average about the expectation.
      </p>
    </subsection>

    <subsection xml:id="subsec-central-limit-theorem">
      <title>The Central Limit Theorem (CLT)</title>
      <p>
        The Law of Large Numbers states that the distribution of the sample average tends to be more concentrated as the sample size increases. The Central Limit Theorem (CLT in short) provides an approximation of this distribution.
      </p>
      <figure xml:id="fig-sampdist8">
        <caption>The CLT for the Uniform(3,7) Distribution</caption>
        <image source="_figures/SampDist8.png" width="60%">
          <description>Plot showing convergence of standardized sample average to Normal distribution</description>
        </image>
      </figure>
      <p>
        The deviation between the sample average and the expectation of the measurement tend to decreases with the increase in sample size. In order to obtain a refined assessment of this deviation one needs to magnify it. The appropriate way to obtain the magnification is to consider the standardized sample average, in which the deviation of the sample average from its expectation is divided by the standard deviation of the sample average:
      </p>
      <me>Z = \frac{\bar X - \Expec(\bar X)}{\sqrt{\Var(\bar X)}}\;.</me>
      <p>
        Recall that the expectation of the sample average is equal to the expectation of a single random variable (<m>\Expec(\bar X) = \Expec(X)</m>) and that the variance of the sample average is equal to the variance of a single observation, divided by the sample size (<m>\Var(\bar X) = \Var(X)/n</m>). Consequently, one may rewrite the standardized sample average in the form:
      </p>
      <me>Z = \frac{\bar X - \Expec(X)}{\sqrt{\Var(X)/n}}= \frac{\sqrt{n}(\bar X - \Expec(X))}{\sqrt{\Var(X)}}\;.</me>
      <p>
        The second equality follows from placing in the numerator the square root of <m>n</m> which <em>divides</em> the term in the denominator. Observe that with the increase of the sample size the decreasing difference between the average and the expectation is magnified by the square root of <m>n</m>.
      </p>
      <p>
        The Central Limit Theorem states that, with the increase in sample size, the sample average converges (after standardization) to the standard Normal distribution.
      </p>
      <p>
        Let us examine the Central Normal Theorem in the context of the example of the Uniform measurement. In <xref ref="fig-sampdist8" /> you may find the (approximated) density of the standardized average for the three sample sizes based on the simulation that we carried out previously (as <em>red</em>, <em>green</em>, and <em>blue</em> lines). Along side with these densities you may also find the theoretical density of the standard Normal distribution (as a <em>black</em> line). Observe that the four curves are almost one on top of the other, proposing that the approximation of the distribution of the average by the Normal distribution is good even for a sample size as small as <m>n=10</m>.
      </p>
      <p>
        However, before jumping to the conclusion that the Central Limit Theorem applies to any sample size, let us consider another example. In this example we repeat the same simulation that we did with the Uniform distribution, but this time we take <m>\mathrm{Exponential}(0.5)</m> measurements instead:
      </p>
      <program language="r">
        <input>
exp.10 &lt;- rep(0,10^5)
exp.100 &lt;- rep(0,10^5)
exp.1000 &lt;- rep(0,10^5)
for(i in 1:10^5) {
  X.samp.10 &lt;- rexp(10,0.5)
  exp.10[i] &lt;- mean(X.samp.10)
  X.samp.100 &lt;- rexp(100,0.5)
  exp.100[i] &lt;- mean(X.samp.100)
  X.samp.1000 &lt;- rexp(1000,0.5)
  exp.1000[i] &lt;- mean(X.samp.1000)
}
        </input>
      </program>
      <figure xml:id="fig-sampdist9">
        <caption>The CLT for the Exponential(0.5) Distribution</caption>
        <image source="_figures/SampDist9.png" width="60%">
          <description>Plot showing convergence of Exponential sample average to Normal distribution</description>
        </image>
      </figure>
      <p>
        The expectation of an <m>\mathrm{Exponential}(0.5)</m> random variable is <m>\Expec(X) = 1/\lambda = 1/0.5 = 2</m> and the variance is <m>\Var(X) = 1/\lambda^2 = 1/(0.5)^2 = 4</m>. Observe below that the expectations of the sample averages are equal to the expectation of the measurement and the variances of the sample averages follow the relation <m>\Var(\bar X) = \Var (X)/n</m>:
      </p>
      <program language="r">
        <input>
mean(exp.10)
mean(exp.100)
mean(exp.1000)
        </input>
      </program>
      <p>
        So the expectations of the sample average are all equal to 2. For the variance we get:
      </p>
      <program language="r">
        <input>
var(exp.10)
var(exp.100)
var(exp.1000)
        </input>
      </program>
      <p>
        Which is in agreement with the decrease proposed by the theory,
      </p>
      <p>
        However, when one examines the densities of the sample averages in <xref ref="fig-sampdist9" /> one may see a clear distinction between the sampling distribution of the average for a sample of size 10 and the normal distribution (compare the <em>red</em> curve to the <em>black</em> curve. The match between the <em>green</em> curve that corresponds to a sample of size <m>n=100</m> and the <em>black</em> line is better, but not perfect. When the sample size is as large as <m>n=1000</m> (the <em>blue</em> curve) then the agreement with the normal curve is very good.
      </p>
    </subsection>

    <subsection xml:id="subsec-applying-clt">
      <title>Applying the Central Limit Theorem</title>
      <p>
        The conclusion of the Central Limit Theorem is that the sampling distribution of the sample average can be approximated by the Normal distribution, regardless what is the distribution of the original measurement, but provided that the sample size is large enough. This statement is very important, since it allows us, in the context of the sample average, to carry out probabilistic computations using the Normal distribution even if we do not know the actual distribution of the measurement. All we need to know for the computation are the expectation of the measurement, its variance (or standard deviation) and the sample size.
      </p>
      <p>
        The theorem can be applied whenever probability computations associated with the sampling distribution of the average are required. The computation of the approximation is carried out by using the Normal distribution with the same expectation and the same standard deviation as the sample average.
      </p>
      <p>
        An example of such computation was conducted in <xref ref="subsec-theoretical-models" /> where the central interval that contains 95% of the sampling distribution of a Binomial average was required. The 2.5%- and the 97.5%-percentiles of the Normal distribution with the same expectation and variance as the sample average produced boundaries for the interval. These boundaries were in good agreement with the boundaries produced by the simulation. More examples will be provided in the Solved Exercises of this chapter and the next one.
      </p>
      <p>
        With all its usefulness, one should treat the Central Limit Theorem with a grain of salt. The approximation may be valid for large samples, but may be bad for samples that are not large enough. When the sample is small a careless application of the Central Limit Theorem may produce misleading conclusions.
      </p>
    </subsection>
  </section>

  <section xml:id="sec-exercises-7">
    <title>Exercises</title>
    <exercise xml:id="ex-sampdist-1">
      <statement>
        <p>
          The file <q><c>pop2.csv</c></q> contains information associated to the blood pressure of an imaginary population of size 100,000. The file can be found on the internet (<url href="http://pluto.huji.ac.il/~msby/StatThink/Datasets/pop2.csv" />). The variables in this file are:
        </p>
        <dl>
          <li>
            <title>id</title>
            <p>A numerical variable. A 7 digits number that serves as a unique identifier of the subject.</p>
          </li>
          <li>
            <title>sex</title>
            <p>A factor variable. The sex of each subject. The values are either <q><c>MALE</c></q> or <q><c>FEMALE</c></q>.</p>
          </li>
          <li>
            <title>age</title>
            <p>A numerical variable. The age of each subject.</p>
          </li>
          <li>
            <title>bmi</title>
            <p>A numerical variable. The body mass index of each subject.</p>
          </li>
          <li>
            <title>systolic</title>
            <p>A numerical variable. The systolic blood pressure of each subject.</p>
          </li>
          <li>
            <title>diastolic</title>
            <p>A numerical variable. The diastolic blood pressure of each subject.</p>
          </li>
          <li>
            <title>group</title>
            <p>A factor variable. The blood pressure category of each subject. The values are <q><c>NORMAL</c></q> if both the systolic blood pressure is within its normal range (between 90 and 139) and the diastolic blood pressure is within its normal range (between 60 and 89). The value is <q><c>HIGH</c></q> if either measurements of blood pressure are above their normal upper limits and it is <q><c>LOW</c></q> if either measurements are below their normal lower limits.</p>
          </li>
        </dl>
        <p>
          Our goal in this question is to investigate the sampling distribution of the sample average of the variable <q><c>bmi</c></q>. We assume a sample of size <m>n=150</m>.
        </p>
        <ol>
          <li><p>Compute the population average of the variable <q><c>bmi</c></q>.</p></li>
          <li><p>Compute the population standard deviation of the variable <q><c>bmi</c></q>.</p></li>
          <li><p>Compute the expectation of the sampling distribution for the sample average of the variable.</p></li>
          <li><p>Compute the standard deviation of the sampling distribution for the sample average of the variable.</p></li>
          <li><p>Identify, using simulations, the central region that contains 80% of the sampling distribution of the sample average.</p></li>
          <li><p>Identify, using the Central Limit Theorem, an approximation of the central region that contains 80% of the sampling distribution of the sample average.</p></li>
        </ol>
      </statement>
    </exercise>

    <exercise xml:id="ex-sampdist-2">
      <statement>
        <p>
          A subatomic particle hits a linear detector at random locations. The length of the detector is 10 nm and the hits are uniformly distributed. The location of 25 random hits, measured from a specified endpoint of the interval, are marked and the average of the location computed.
        </p>
        <ol>
          <li><p>What is the expectation of the average location?</p></li>
          <li><p>What is the standard deviation of the average location?</p></li>
          <li><p>Use the Central Limit Theorem in order to approximate the probability the average location is in the left-most third of the linear detector.</p></li>
          <li><p>The central region that contains 99% of the distribution of the average is of the form <m>5 \pm c</m>. Use the Central Limit Theorem in order to approximate the value of c.</p></li>
        </ol>
      </statement>
    </exercise>
  </section>

  <section xml:id="sec-summary-7">
    <title>Summary</title>

    <subsection xml:id="subsec-glossary-7">
      <title>Glossary</title>
      <dl>
        <li>
          <title>Random Sample</title>
          <p>The probabilistic model for the values of a measurements in the sample, before the measurement is taken.</p>
        </li>
        <li>
          <title>Sampling Distribution</title>
          <p>The distribution of a random sample.</p>
        </li>
        <li>
          <title>Sampling Distribution of a Statistic</title>
          <p>A statistic is a function of the data; i.e. a formula applied to the data. The statistic becomes a random variable when the formula is applied to a random sample. The distribution of this random variable, which is inherited from the distribution of the sample, is its sampling distribution.</p>
        </li>
        <li>
          <title>Sampling Distribution of the Sample Average</title>
          <p>The distribution of the sample average, considered as a random variable.</p>
        </li>
        <li>
          <title>The Law of Large Numbers</title>
          <p>A mathematical result regarding the sampling distribution of the sample average. States that the distribution of the average of measurements is highly concentrated in the vicinity of the expectation of a measurement when the sample size is large.</p>
        </li>
        <li>
          <title>The Central Limit Theorem</title>
          <p>A mathematical result regarding the sampling distribution of the sample average. States that the distribution of the average is approximately Normal when the sample size is large.</p>
        </li>
      </dl>
    </subsection>

    <subsection xml:id="subsec-discussion-forum-7">
      <title>Discussion in the Forum</title>
      <p>
        Limit theorems in mathematics deal with the convergence of some property to a limit as some indexing parameter goes to infinity. The Law of Large Numbers and the Central Limit Theorem are examples of limit theorems. The property they consider is the sampling distribution of the sample average. The indexing parameter that goes to infinity is the sample size <m>n</m>.
      </p>
      <p>
        Some people say that the Law of Large Numbers and the Central Limit Theorem are useless for practical purposes. These theorems deal with a sample size that goes to infinity. However, all sample sizes one finds in reality are necessarily finite. What is your opinion?
      </p>
      <p>
        When forming your answer to this question you may give an example of a situation from your own field of interest in which conclusions of an abstract mathematical theory are used in order to solve a practical problem. Identify the merits and weaknesses of the application of the mathematical theory.
      </p>
      <p>
        For example, in making statistical inference one frequently needs to make statements regarding the sampling distribution of the sample average. For instant, one may want to identify the central region that contains 95% of the distribution. The Normal distribution is used in the computation. The justification is the Central Limit Theorem.
      </p>
    </subsection>

    <subsection xml:id="subsec-summary-formulas-7">
      <title>Summary of Formulas</title>
      <dl>
        <li>
          <title>Expectation of the sample average</title>
          <p><m>\Expec(\bar X) = \Expec(X)</m></p>
        </li>
        <li>
          <title>Variance of the sample average</title>
          <p><m>\Var(\bar X) = \Var(X)/n</m></p>
        </li>
      </dl>
    </subsection>
  </section>
</chapter>
